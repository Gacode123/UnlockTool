<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pengelola Akun Unlock Tool</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" />
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyBzoi1KKiiXXC5kXQHoTHA8OXBq5mCM1vw",
        authDomain: "unlocktool-5ae45.firebaseapp.com",
        databaseURL: "https://unlocktool-5ae45-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "unlocktool-5ae45",
        storageBucket: "unlocktool-5ae45.firebasestorage.app",
        messagingSenderId: "321966892442",
        appId: "1:321966892442:web:145de4877c642feac30623",
        measurementId: "G-38Y0D6LEF7"
      };
      firebase.initializeApp(firebaseConfig);
    </script>
    <style>
      :root {
        --primary-color: #5469d4;
        --success-color: #0ca678;
        --danger-color: #e03131;
        --warning-color: #f59f00;
        --purple-color: #9775fa;
        --dark-color: #343a40;
        --light-color: #f8f9fa;
        --border-radius: 10px;
        --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
        --transition: all 0.3s ease;
      }
      *{margin:0;padding:0;box-sizing:border-box}
      body{font-family:Poppins,sans-serif;background-color:#f5f7fb;color:#333;padding:10px;line-height:1.6;position:relative}
      .version-badge{position:fixed;top:10px;left:10px;background-color:var(--primary-color);color:#fff;padding:8px 15px;border-radius:15px;font-size:.8rem;font-weight:500;z-index:1000;box-shadow:0 2px 4px rgba(0,0,0,.1);cursor:pointer;transition:var(--transition);display:inline-block;min-width:60px;text-align:center}
      .version-badge:hover{background-color:#4559b3;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.1)}
      .container{max-width:1200px;margin:0 auto;padding:15px}
      .account-summary{text-align:left;background-color:#fff;padding:20px;border-radius:var(--border-radius);margin-bottom:20px;box-shadow:var(--box-shadow);font-size:1rem}
      .account-summary p{margin:0 0 10px 0}
      h1{text-align:center;font-weight:600;color:var(--dark-color);margin-bottom:30px;font-size:2.2rem}
      .add-account-btn{background-color:var(--primary-color);color:#fff;padding:12px 24px;border:none;border-radius:var(--border-radius);font-weight:500;font-size:1rem;cursor:pointer;display:block;margin:0 auto 30px auto;transition:var(--transition);box-shadow:var(--box-shadow)}
      .add-account-btn:hover{background-color:#4559b3;transform:translateY(-2px)}
      .buttons-container{display:flex;justify-content:center;gap:15px;margin-bottom:30px;flex-wrap:nowrap}
      .action-btn{flex:1;padding:12px 15px;color:#fff;border:none;border-radius:var(--border-radius);font-weight:500;font-size:1rem;cursor:pointer;transition:var(--transition);box-shadow:var(--box-shadow);text-align:center}
      .action-btn:hover{transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,.15)}
      .add-btn{background-color:var(--success-color)}
      .add-btn:hover{background-color:#099268}
      .ads-btn{background-color:var(--warning-color)}
      .ads-btn:hover{background-color:#e69500}
      .export-btn{background-color:var(--primary-color)}
      .export-btn:hover{background-color:#4559b3}
      .import-btn{background-color:var(--dark-color);position:relative}
      .import-btn:hover{background-color:#212529}
      .import-btn input[type=file]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}
      .accounts-container{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px}
      .account-card{background-color:#fff;border-radius:var(--border-radius);overflow:hidden;box-shadow:var(--box-shadow);transition:var(--transition);border-top:4px solid var(--primary-color)}
      .account-card.highlight{border:2px solid var(--success-color);border-top:4px solid var(--success-color);animation:pulse 2s infinite}
      @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(12,166,120,.4)}70%{box-shadow:0 0 0 10px rgba(12,166,120,0)}100%{box-shadow:0 0 0 0 rgba(12,166,120,0)}}
      .account-card:hover{transform:translateY(-5px);box-shadow:0 10px 20px rgba(0,0,0,.1)}
      .account-header{padding:15px 20px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center;gap:12px}
      .account-header-left{display:flex;align-items:center;gap:12px;min-width:0}
      .account-header h2{font-size:1.32rem;font-weight:700;margin:0;color:var(--dark-color);font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text","Helvetica Neue",Helvetica,Arial,sans-serif;letter-spacing:-.02em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
      .delete-account-btn{height:36px;width:36px;display:grid;place-items:center;border-radius:10px;background:#fff5f5;border:1px solid #ffe3e3;color:var(--danger-color);cursor:pointer;transition:var(--transition)}
      .delete-account-btn:hover{background:rgba(224,49,49,.1);transform:translateY(-1px)}
      .copy-info-container{padding:8px 16px;background-color:rgba(84,105,212,.08);border-bottom:1px solid #eee;text-align:center}
      .primary-copy-btn{background-color:var(--primary-color);color:#fff;padding:10px 15px;font-size:1rem;border-radius:6px;width:100%;font-weight:500;transition:var(--transition);box-shadow:0 2px 4px rgba(0,0,0,.1)}
      .primary-copy-btn:hover{background-color:#4559b3;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.1)}
      .status{font-size:.8rem;font-weight:500;padding:5px 10px;border-radius:20px;white-space:nowrap}
      .status.available{background-color:rgba(12,166,120,.15);color:var(--success-color)}
      .status.rented{background-color:rgba(224,49,49,.15);color:var(--danger-color)}
      .status.not-ready{background-color:rgba(245,159,0,.15);color:var(--warning-color)}
      .account-body{padding:16px}
      .small-copy-btn{background:none;color:#666;border:none;border-radius:4px;padding:4px 6px;font-size:1.1rem;cursor:pointer;margin-right:8px;transition:var(--transition);min-width:35px;height:24px;display:inline-flex;align-items:center;justify-content:center;font-weight:500}
      .small-copy-btn:hover{color:var(--primary-color);transform:scale(1.1)}
      .small-copy-btn:active{transform:scale(.95)}
      .input-with-copy{display:flex;align-items:center;gap:0}
      .input-with-copy input{flex:1;margin:0}
      .form-group{margin-bottom:15px}
      label{display:block;margin-bottom:6px;font-weight:500;font-size:.9rem;color:#555}
      input[type=text],input[type=password]{width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:6px;font-family:Poppins,sans-serif;font-size:.9rem;transition:var(--transition)}
      input[type=text]:focus,input[type=password]:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 2px rgba(84,105,212,.2)}
      .time-info{background-color:#f8f9fa;padding:10px 15px;border-radius:8px;margin-bottom:15px;font-size:.85rem}
      .time-info strong{color:var(--dark-color);font-weight:600}
      .btn-container{margin-top:20px}
      .btn-group{display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap}
      .btn-group.duration-buttons{margin-bottom:10px}
      .btn-group.control-buttons{display:grid;grid-template-columns:repeat(auto-fit,minmax(80px,1fr))}
      button{padding:8px 12px;border:none;border-radius:6px;cursor:pointer;font-weight:500;font-size:.85rem;transition:var(--transition)}
      .rent-btn{background-color:var(--success-color);color:#fff;flex:1;min-width:80px}
      .rent-btn:hover{background-color:#099268}
      .copy-btn{background-color:var(--primary-color);color:#fff;flex:1}
      .copy-btn:hover{background-color:#4559b3}
      .reset-btn{background-color:var(--danger-color);color:#fff}
      .reset-btn:hover{background-color:#c92a2a}
      .update-btn{background-color:var(--warning-color);color:#fff}
      .update-btn:hover{background-color:#e69500}
      .manual-btn{background-color:var(--purple-color);color:#fff}
      .manual-btn:hover{background-color:#845ef7}
      .ready-btn{background-color:var(--warning-color);color:#fff;width:100%;padding:12px;font-size:1rem;font-weight:500;border:none;border-radius:var(--border-radius);cursor:pointer;transition:var(--transition);box-shadow:var(--box-shadow)}
      .ready-btn:hover{background-color:#e69500;transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,.15)}
      .modal{display:none;position:fixed;z-index:100;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,.5);backdrop-filter:blur(4px)}
      .modal-content{background-color:#fff;margin:10% auto;padding:25px;border-radius:var(--border-radius);width:350px;box-shadow:0 10px 25px rgba(0,0,0,.2);animation:modalFadeIn .3s}
      @keyframes modalFadeIn{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}
      .modal h3{margin-bottom:20px;font-weight:600;color:var(--dark-color);padding-bottom:10px;border-bottom:1px solid #eee}
      .close{color:#aaa;float:right;font-size:28px;font-weight:700;line-height:.8;cursor:pointer;transition:var(--transition)}
      .close:hover{color:var(--dark-color)}
      .modal input[type=date],.modal input[type=time]{width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:6px;font-family:Poppins,sans-serif;margin-bottom:15px;font-size:.9rem}
      .modal button{width:100%;padding:12px;margin-top:10px;font-size:.95rem}
      .notification{position:fixed;top:20px;left:20px;background-color:var(--success-color);color:#fff;padding:15px 20px;border-radius:6px;box-shadow:0 4px 8px rgba(0,0,0,.1);z-index:1000;opacity:0;transform:translateY(-20px);transition:opacity .3s,transform .3s}
      .notification.show{opacity:1;transform:translateY(0)}
      @media (max-width:768px){.accounts-container{grid-template-columns:1fr}}
      .filter-container{display:flex;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:10px}
      .filter-container label{margin-right:10px;margin-bottom:0}
      .email-filter{padding:5px 10px;border-radius:5px;border:1px solid #ddd;font-family:Poppins,sans-serif;font-size:.9rem;flex-grow:1;max-width:250px;cursor:pointer}
      .email-filter:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 2px rgba(84,105,212,.2)}
      .email-counter-available{color:var(--success-color);font-weight:600}
      .email-counter-total{color:#6c757d;font-weight:500}
      .account-stats{margin-left:auto;white-space:nowrap;font-size:.9rem}
      .search-label{margin-left:10px}
      .search-container{position:relative;flex-grow:1;max-width:300px}
      .clear-search-btn{position:absolute;right:8px;top:50%;transform:translateY(-50%);background:none;border:none;color:#999;font-size:20px;font-weight:700;cursor:pointer;display:flex;padding:8px 10px;line-height:1;border-radius:50%;min-width:36px;min-height:36px;align-items:center;justify-content:center}
      .clear-search-btn:hover{color:var(--danger-color);background-color:rgba(224,49,49,.1)}
      .search-input{width:100%;padding:5px 30px 5px 10px;border-radius:5px;border:1px solid #ddd;font-family:Poppins,sans-serif;font-size:.9rem}
      .search-input:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 2px rgba(84,105,212,.2)}
      .summary-row{display:flex;width:100%;justify-content:space-between;margin-top:15px}
      .summary-left{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;width:100%}
      .quick-rent-btn{background-color:var(--success-color);color:#fff;border:none;padding:15px 20px;border-radius:var(--border-radius);font-weight:600;font-size:1.1rem;cursor:pointer;transition:var(--transition);box-shadow:var(--box-shadow)}
      .quick-rent-btn:hover{background-color:#099268;transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,.15)}
      .quick-rent-btn-12{background-color:var(--warning-color);color:#fff;border:none;padding:15px 20px;border-radius:var(--border-radius);font-weight:600;font-size:1.1rem;cursor:pointer;transition:var(--transition);box-shadow:var(--box-shadow)}
      .quick-rent-btn-12:hover{background-color:#e69500;transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,.15)}
      .quick-rent-btn-24{background-color:var(--purple-color);color:#fff;border:none;padding:15px 20px;border-radius:var(--border-radius);font-weight:600;font-size:1.1rem;cursor:pointer;transition:var(--transition);box-shadow:var(--box-shadow)}
      .quick-rent-btn-24:hover{background-color:#845ef7;transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,.15)}
      @media (max-width:768px){.summary-left{grid-template-columns:1fr}}
      .scroll-to-top{position:fixed;bottom:30px;right:30px;background-color:var(--primary-color);color:#fff;width:67.5px;height:67.5px;border-radius:50%;display:none;justify-content:center;align-items:center;cursor:pointer;box-shadow:0 2px 10px rgba(0,0,0,.2);transition:var(--transition);z-index:1000;font-size:30px}
      .scroll-to-top:hover{background-color:#4559b3;transform:translateY(-3px);box-shadow:0 4px 15px rgba(0,0,0,.3)}
      .scroll-to-top.show{display:flex}
      .modal-content.bulk-add{width:500px;max-width:90%}
      .bulk-textarea{width:100%;height:300px;padding:12px;font-family:Poppins,sans-serif;border:1px solid #ddd;border-radius:6px;resize:vertical;margin-bottom:15px}
      .bulk-textarea:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 2px rgba(84,105,212,.2)}
      .login-container{max-width:400px;margin:100px auto;padding:25px;background-color:#fff;border-radius:var(--border-radius);box-shadow:var(--box-shadow);text-align:center}
      .login-container h2{margin-bottom:25px;color:var(--dark-color);font-weight:600}
      .login-container input{width:100%;padding:12px 15px;margin-bottom:15px;border:1px solid #ddd;border-radius:var(--border-radius);font-family:Poppins,sans-serif;font-size:.95rem}
      .login-container input:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 2px rgba(84,105,212,.2)}
      .login-btn{background-color:var(--primary-color);color:#fff;padding:12px 20px;border:none;border-radius:var(--border-radius);font-weight:500;font-size:1rem;cursor:pointer;width:100%;transition:var(--transition)}
      .login-btn:hover{background-color:#4559b3;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.1)}
      .error-message{color:var(--danger-color);margin-bottom:15px;font-size:.9rem}
      .logout-btn{background-color:#f8f9fa;color:var(--dark-color);border:1px solid #ddd;padding:8px 15px;border-radius:var(--border-radius);font-size:.9rem;cursor:pointer;margin-left:10px;transition:var(--transition)}
      .logout-btn:hover{background-color:#e9ecef}
      @keyframes loadingSpin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
      .danger-btn{background-color:var(--danger-color);color:#fff}
      .danger-btn:hover{background-color:#c92a2a}
      .purple-btn{background-color:var(--purple-color)}
      .purple-btn:hover{background-color:#845ef7}
      .quick-rent-btn-9{background-color:#20c997;color:#fff;border:none;padding:15px 20px;border-radius:var(--border-radius);font-weight:600;font-size:1.1rem;cursor:pointer;transition:var(--transition);box-shadow:var(--box-shadow)}
      .quick-rent-btn-9:hover{background-color:#12b886;transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,.15)}
      .btn-disabled{background-color:#adb5bd!important;cursor:not-allowed!important;opacity:.7}
      .password-card{display:flex;align-items:center;background:#f8f9fa;border:1px solid #ddd;border-radius:5px;padding:6px 10px;margin:4px 0;font-size:.95em;cursor:move;user-select:none;transition:all .2s ease;position:relative;z-index:1}
      .password-card:hover{background:#e9ecef;transform:translateY(-2px);box-shadow:0 2px 5px rgba(0,0,0,.1)}
      .password-card.sortable-chosen{background:#e7f5ff;border-color:#74c0fc;opacity:.8;transform:scale(1.05);box-shadow:0 5px 15px rgba(0,0,0,.1);z-index:10}
      .password-card.sortable-ghost{opacity:.4;background:#e7f5ff}
      .password-card.sortable-drag{opacity:.9;transform:rotate(2deg) scale(1.05);transition:transform .15s cubic-bezier(.2,0,.13,2)}
      .password-card span{flex:1;cursor:pointer;padding:2px 4px}
      .password-card .delete-btn{background:none;border:none;color:#e03131;font-size:16px;cursor:pointer;opacity:.7;transition:all .2s ease;margin-left:8px;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:50%}
      .password-card .delete-btn:hover{opacity:1;background-color:rgba(224,49,49,.1)}
      #passwordListContainer{display:flex;flex-direction:row;flex-wrap:wrap;gap:6px;margin-top:8px;min-height:50px;padding:5px;background-color:#fff;border-radius:8px;border:1px dashed #ddd}
      .password-card.active{background:#e7f5ff;border-color:#4dabf7;box-shadow:0 2px 8px rgba(77,171,247,.3);transform:translateY(-2px)}
      .custom-select-wrapper{position:relative;flex-grow:0;max-width:none;min-width:auto;width:auto}
      .next-email-btn{background-color:var(--primary-color);color:#fff;border:none;border-radius:5px;padding:5px 12px;font-size:.9rem;cursor:pointer;transition:var(--transition);height:32px;min-width:40px;display:flex;align-items:center;justify-content:center;font-weight:700}
      .next-email-btn:hover{background-color:#4559b3;transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,.1)}
      .next-email-btn:active{transform:translateY(0)}
      .next-email-btn:disabled{background-color:#adb5bd;cursor:not-allowed;opacity:.6}
      .sort-expiration-btn{background-color:var(--purple-color);color:#fff;border:none;border-radius:5px;padding:5px 10px;font-size:.8rem;cursor:pointer;transition:var(--transition);margin-right:15px;font-weight:500}
      .sort-expiration-btn:hover{background-color:#845ef7;transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,.1)}
      .sort-expiration-btn:active{transform:translateY(0)}
      .sort-expiration-btn.active{background-color:#7048e8;box-shadow:0 0 0 2px rgba(151,117,250,.3)}
      .custom-select{position:relative;flex:1}
      .select-trigger{background-color:#fff;border:1px solid #ddd;border-radius:5px;padding:5px 30px 5px 10px;font-family:Poppins,sans-serif;font-size:.9rem;cursor:pointer;position:relative;display:flex;align-items:center;justify-content:space-between;white-space:nowrap;min-width:120px;width:auto;max-width:350px}
      .select-trigger:hover{border-color:#bbb}
      .select-trigger.active{border-color:var(--primary-color);box-shadow:0 0 0 2px rgba(84,105,212,.2)}
      .arrow{font-size:12px;color:#999;transition:transform .3s}
      .select-trigger.active .arrow{transform:rotate(180deg)}
      .custom-options{position:absolute;top:100%;left:0;background-color:#fff;border:1px solid #ddd;border-top:none;border-radius:0 0 5px 5px;z-index:1000;display:none;box-shadow:0 4px 6px rgba(0,0,0,.1);min-width:100%;width:auto;white-space:nowrap;padding:4px}
      .custom-options.show{display:block}
      .custom-option{padding:8px 10px;cursor:pointer;font-family:Poppins,sans-serif;font-size:.9rem;border-bottom:1px solid #f0f0f0;transition:all .3s ease;white-space:nowrap;border-radius:4px;margin:2px 4px}
      .custom-option:last-child{border-bottom:none}
      .custom-option:hover{background:linear-gradient(135deg,#e3f2fd 0%,#bbdefb 100%);color:#1565c0;transform:translateX(3px);box-shadow:0 2px 8px rgba(33,150,243,.15);border-radius:6px}
      .custom-option.selected{background-color:var(--primary-color);color:#fff;box-shadow:0 2px 8px rgba(84,105,212,.3)}
      .custom-option.selected:hover{background:linear-gradient(135deg,var(--primary-color) 0%,#4559b3 100%);transform:translateX(3px)}
    </style>
  </head>
  <body>
    <a href="https://github.com/Gacode123/UnlockTool" target="_blank" style="text-decoration: none; display: inline-block">
      <div class="version-badge">v3.1</div>
    </a>
    <div id="lastResetLabel" style="position: fixed; top: 45px; left: 10px; font-size: 0.75rem; color: #555">Last All Reset at: <span id="lastResetTime">--:--</span></div>
    <div id="loadingScreen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: white; display: flex; justify-content: center; align-items: center; z-index: 9999">
      <div style="text-align: center">
        <div style="border: 4px solid #f3f3f3; border-top: 4px solid #5469d4; border-radius: 50%; width: 40px; height: 40px; margin: 0 auto 20px; animation: loadingSpin 1s linear infinite"></div>
        <p style="font-family: 'Poppins', sans-serif; color: #333; font-weight: 500">Loading...</p>
      </div>
    </div>
    <div id="loginContainer" class="login-container" style="display: none">
      <h2>Login Unlock Tool</h2>
      <div id="errorMessage" class="error-message"></div>
      <input type="email" id="email" placeholder="Email" required />
      <input type="password" id="password" placeholder="Password" required />
      <div style="display: flex; align-items: center; margin-bottom: 15px; justify-content: center">
        <input type="checkbox" id="rememberMe" checked style="width: auto; margin-right: 8px; cursor: pointer" />
        <label for="rememberMe" style="margin-bottom: 0; cursor: pointer">Ingat Saya</label>
      </div>
      <button id="loginBtn" class="login-btn">Login</button>
    </div>
    <div id="appContainer" style="display: none">
      <div class="container">
        <div class="buttons-container">
          <button id="addAccountBtn" class="action-btn add-btn">Tambah Akun Baru</button>
          <button id="bulkAddBtn" class="action-btn add-btn">Bulk Add Account</button>
          <button id="bulkChangePwdBtn" class="action-btn purple-btn">Bulk Change Password</button>
          <button class="action-btn ads-btn">Setting Iklan</button>
          <button id="exportBtn" class="action-btn export-btn">Ekspor Data</button>
          <div class="action-btn import-btn">
            Impor Data
            <input type="file" id="importFile" accept=".json" />
          </div>
          <button id="resetAllBtn" class="action-btn danger-btn">Reset All Available</button>
          <button id="logoutBtn" class="logout-btn">Logout</button>
        </div>
        <div class="account-summary">
          <div class="filter-container">
            <label for="emailFilter"><strong>Filter Email:</strong></label>
            <button id="nextEmailBtn" class="next-email-btn" title="Pindah ke email berikutnya">▶</button>
            <div class="custom-select-wrapper">
              <div id="emailFilter" class="custom-select">
                <div class="select-trigger">
                  <span>Semua Email</span>
                  <div class="arrow">▼</div>
                </div>
                <div class="custom-options">
                  <div class="custom-option active" data-value="">Semua Email</div>
                </div>
              </div>
            </div>
            <label for="usernameSearch" class="search-label"><strong>Cari Username:</strong></label>
            <div class="search-container">
              <input type="text" id="usernameSearch" class="search-input" placeholder="Ketik untuk mencari..." />
              <button type="button" id="clearSearch" class="clear-search-btn">&times;</button>
            </div>
            <div class="account-stats">
              <button id="sortByExpirationBtn" class="sort-expiration-btn" title="Sort berdasarkan expiration date">📅 Sort Expiration</button>
              <strong>Total:</strong> <span id="totalAccounts">0</span> | <strong>Ready:</strong> <span id="availableAccounts">0</span>
            </div>
            <div id="passwordListContainer" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 5px"></div>
          </div>
          <div class="summary-row">
            <div class="summary-left">
              <button id="quickRentBtn" class="quick-rent-btn">⚡ 6 Jam</button>
              <button id="quickRent9Btn" class="quick-rent-btn-9">⚡ 9 Jam</button>
              <button id="quickRent12Btn" class="quick-rent-btn-12">⚡ 12 Jam</button>
              <button id="quickRent24Btn" class="quick-rent-btn-24">⚡ 24 Jam</button>
            </div>
          </div>
        </div>
        <div class="accounts-container" id="accountsContainer"></div>
      </div>
    </div>
    <div class="scroll-to-top" id="scrollToTop">↑</div>
    <div id="manualModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h3>Input Manual Waktu Berakhir</h3>
        <div class="form-group">
          <div style="margin-bottom: 10px">
            <label style="display: inline-flex; align-items: center; margin-right: 20px">
              <input type="radio" name="timeInputType" value="exact" onchange="toggleTimeInputType()" />
              <span style="margin-left: 5px">Waktu Exact</span>
            </label>
            <label style="display: inline-flex; align-items: center">
              <input type="radio" name="timeInputType" value="duration" checked onchange="toggleTimeInputType()" />
              <span style="margin-left: 5px">Durasi</span>
            </label>
          </div>
        </div>
        <div id="exactTimeInputs" style="display: none">
          <div class="form-group">
            <label for="manualDate">Tanggal:</label>
            <input type="date" id="manualDate" required />
          </div>
          <div class="form-group">
            <label for="manualTime">Jam:</label>
            <input type="time" id="manualTime" required />
          </div>
        </div>
        <div id="durationInputs">
          <div class="form-group">
            <label for="durationHours">Jam:</label>
            <input type="number" id="durationHours" min="0" max="72" value="0" required style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-family: 'Poppins', sans-serif; font-size: 0.9rem" />
          </div>
          <div class="form-group">
            <label for="durationMinutes">Menit:</label>
            <input type="number" id="durationMinutes" min="0" max="59" value="0" required style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-family: 'Poppins', sans-serif; font-size: 0.9rem" />
          </div>
        </div>
        <button id="saveManualBtn" class="rent-btn">Simpan</button>
      </div>
    </div>
    <div id="bulkAddModal" class="modal">
      <div class="modal-content bulk-add">
        <span class="close" id="closeBulkModal">&times;</span>
        <h3>Bulk Add Account</h3>
        <div class="form-group">
          <label for="bulkInput">Format: Username diikuti Email (2 format didukung)</label>
          <textarea
            id="bulkInput"
            class="bulk-textarea"
            placeholder="Format 1 (dengan baris kosong):&#10;username1&#10;email1@domain.com&#10;&#10;username2&#10;email2@domain.com&#10;&#10;Format 2 (tanpa baris kosong):&#10;username1&#10;email1@domain.com&#10;username2&#10;email2@domain.com"
          ></textarea>
        </div>
        <p style="margin-bottom: 15px; font-size: 0.9rem; color: #666">Password default: wawawa666</p>
        <button id="processBulkBtn" class="add-btn" style="width: 100%">Tambahkan Akun</button>
      </div>
    </div>
    <div id="bulkChangePwdModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeBulkChangePwdModal()">&times;</span>
        <h3>Bulk Change Password</h3>
        <div class="form-group">
          <label for="newPassword">New Password:</label>
          <input type="password" id="newPassword" />
        </div>
        <button class="rent-btn" onclick="applyBulkChangePwd()">Ganti Semua</button>
      </div>
    </div>
    <div id="notification" class="notification"></div>
    <script>
      let authCheckComplete = false;
      window.addEventListener("error", function (event) {
        document.getElementById("loadingScreen").style.display = "none";
      });
      document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("loadingScreen").style.display = "flex";
        document.getElementById("loginContainer").style.display = "none";
        document.getElementById("appContainer").style.display = "none";
        setTimeout(function () {
          firebase.auth().onAuthStateChanged(function (user) {
            authCheckComplete = true;
            document.getElementById("loadingScreen").style.display = "none";
            if (user) {
              document.getElementById("appContainer").style.display = "block";
              initializeApp();
              window.addEventListener("beforeunload", function () {
                localStorage.setItem("lastSortTime", new Date().getTime());
              });
              const lastSortTime = localStorage.getItem("lastSortTime");
              if (lastSortTime) {
                const timeSinceLastSort = new Date().getTime() - parseInt(lastSortTime);
                if (timeSinceLastSort > 60000) {
                  setTimeout(() => {
                    if (accountManager) {
                      accountManager.renderAccounts(true);
                    }
                  }, 1000);
                }
              }
            } else {
              document.getElementById("loginContainer").style.display = "block";
            }
          });
        }, 300);
      });
      document.getElementById("loginBtn").addEventListener("click", () => {
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const rememberMe = document.getElementById("rememberMe").checked;
        const errorMessage = document.getElementById("errorMessage");
        if (!email || !password) {
          errorMessage.textContent = "Mohon isi email dan password";
          return;
        }
        document.getElementById("loadingScreen").style.display = "flex";
        document.getElementById("loginContainer").style.display = "none";
        const persistenceType = rememberMe ? firebase.auth.Auth.Persistence.LOCAL : firebase.auth.Auth.Persistence.SESSION;
        firebase
          .auth()
          .setPersistence(persistenceType)
          .then(() => firebase.auth().signInWithEmailAndPassword(email, password))
          .then(() => {
            errorMessage.textContent = "";
          })
          .catch((error) => {
            document.getElementById("loadingScreen").style.display = "none";
            document.getElementById("loginContainer").style.display = "block";
            if (error.code === "auth/wrong-password" || error.code === "auth/user-not-found") {
              errorMessage.textContent = "Email atau password salah";
            } else {
              errorMessage.textContent = "Error: " + error.message;
            }
          });
      });
      document.getElementById("password").addEventListener("keyup", (event) => {
        if (event.key === "Enter") {
          document.getElementById("loginBtn").click();
        }
      });
      function initializeApp() {
        try {
          accountManager = new AccountManager();
          setInterval(() => {
            accountManager.renderAccounts(true);
          }, 30000);
          document.getElementById("logoutBtn").addEventListener("click", () => {
            document.getElementById("loadingScreen").style.display = "flex";
            document.getElementById("appContainer").style.display = "none";
            firebase
              .auth()
              .signOut()
              .then(() => {
                document.getElementById("loadingScreen").style.display = "none";
                document.getElementById("loginContainer").style.display = "block";
              })
              .catch(() => {
                document.getElementById("loadingScreen").style.display = "none";
                document.getElementById("loginContainer").style.display = "block";
              });
          });
          document.getElementById("quickRentBtn")?.addEventListener("click", () => accountManager.quickRent(6));
          document.getElementById("quickRent9Btn")?.addEventListener("click", () => accountManager.quickRent(9));
          document.getElementById("quickRent12Btn")?.addEventListener("click", () => accountManager.quickRent(12));
          document.getElementById("quickRent24Btn")?.addEventListener("click", () => accountManager.quickRent(24));
          document.getElementById("addAccountBtn")?.addEventListener("click", () => accountManager.addAccount());
          document.getElementById("bulkAddBtn")?.addEventListener("click", openBulkModal);
          document.getElementById("bulkChangePwdBtn")?.addEventListener("click", openBulkChangePwdModal);
          document.querySelector(".ads-btn")?.addEventListener("click", () => {
            window.open("https://seller.shopee.co.id/portal/marketing/pas/product/manual/315686975?from=1742317200&to=1742403599&group=today", "_blank");
          });
          document.getElementById("exportBtn")?.addEventListener("click", () => accountManager.exportData());
          document.getElementById("importFile")?.addEventListener("change", (event) => {
            if (event.target.files.length > 0) {
              const file = event.target.files[0];
              if (file.type === "application/json" || file.name.endsWith(".json")) {
                accountManager.importData(file);
              } else {
                accountManager.showNotification("Format file tidak valid. Harap pilih file JSON.");
              }
              event.target.value = "";
            }
          });
          document.querySelector(".close")?.addEventListener("click", closeManualModal);
          document.getElementById("saveManualBtn")?.addEventListener("click", saveManualTime);
          const processBulkBtn = document.getElementById("processBulkBtn");
          if (processBulkBtn) {
            processBulkBtn.addEventListener("click", function (event) {
              event.preventDefault();
              try {
                processBulkAccounts();
              } catch (error) {
                alert("Terjadi error: " + error.message);
              }
            });
          }
          document.getElementById("closeBulkModal")?.addEventListener("click", closeBulkModal);
          document.getElementById("emailFilter")?.addEventListener("change", (event) => {
            accountManager.setEmailFilter(event.target.value);
          });
          const emailFilter = document.getElementById("emailFilter");
          if (emailFilter) {
            const selectTrigger = emailFilter.querySelector(".select-trigger");
            const customOptions = emailFilter.querySelector(".custom-options");
            selectTrigger.addEventListener("click", () => {
              selectTrigger.classList.toggle("active");
              customOptions.classList.toggle("show");
            });
            emailFilter.addEventListener("click", (event) => {
              if (event.target.classList.contains("custom-option")) {
                const value = event.target.getAttribute("data-value");
                accountManager.setEmailFilter(value);
                selectTrigger.classList.remove("active");
                customOptions.classList.remove("show");
              }
            });
            document.addEventListener("click", (event) => {
              if (!emailFilter.contains(event.target)) {
                selectTrigger.classList.remove("active");
                customOptions.classList.remove("show");
              }
            });
          }
          document.getElementById("usernameSearch")?.addEventListener("input", (event) => {
            accountManager.setSearchQuery(event.target.value);
            const clearButton = document.getElementById("clearSearch");
            if (clearButton) {
              clearButton.style.display = event.target.value ? "block" : "none";
            }
          });
          document.getElementById("clearSearch")?.addEventListener("click", () => {
            const searchInput = document.getElementById("usernameSearch");
            if (searchInput) {
              searchInput.value = "";
              accountManager.setSearchQuery("");
              document.getElementById("clearSearch").style.display = "none";
              searchInput.focus();
            }
          });
          const scrollToTopBtn = document.getElementById("scrollToTop");
          if (scrollToTopBtn) {
            window.addEventListener("scroll", () => {
              if (window.pageYOffset > 300) {
                scrollToTopBtn.classList.add("show");
              } else {
                scrollToTopBtn.classList.remove("show");
              }
            });
            scrollToTopBtn.addEventListener("click", () => {
              window.scrollTo({ top: 0, behavior: "smooth" });
            });
          }
          window.addEventListener("click", (event) => {
            const manualModal = document.getElementById("manualModal");
            const bulkAddModal = document.getElementById("bulkAddModal");
            if (event.target == manualModal) closeManualModal();
            if (event.target == bulkAddModal) closeBulkModal();
          });
          document.getElementById("resetAllBtn").addEventListener("click", () => accountManager.resetAllAvailable());
          document.getElementById("nextEmailBtn")?.addEventListener("click", () => accountManager.moveToNextEmail());
          document.getElementById("sortByExpirationBtn")?.addEventListener("click", () => accountManager.toggleSortByExpiration());
          document.getElementById("lastResetTime").textContent = "--:--";
        } catch (err) {}
      }
      function getRemainingTime(availableAt) {
        if (!availableAt) return null;
        const now = new Date();
        const availableDate = new Date(availableAt);
        const diffMs = availableDate - now;
        if (diffMs <= 0) return "Available";
        const diffMinutes = Math.floor(diffMs / (1000 * 60));
        const diffHours = Math.floor(diffMinutes / 60);
        const remainingMinutes = diffMinutes % 60;
        if (diffHours > 0) return `${diffHours} jam ${remainingMinutes} menit lagi`;
        else return `${remainingMinutes} menit lagi`;
      }
      function formatDateTime(date) {
        if (!date) return "Available";
        const options = { day: "2-digit", month: "2-digit", year: "numeric", hour: "2-digit", minute: "2-digit", hour12: false };
        return new Date(date).toLocaleString("id-ID", options);
      }
      function copyToClipboard(text, buttonElement) {
        const textarea = document.createElement("textarea");
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand("copy");
        document.body.removeChild(textarea);
        const originalText = buttonElement.textContent;
        buttonElement.textContent = "Tersalin!";
        if (buttonElement.classList.contains("primary-copy-btn")) {
          buttonElement.style.backgroundColor = "#099268";
          setTimeout(() => {
            buttonElement.textContent = originalText;
            buttonElement.style.backgroundColor = "#5469d4";
          }, 1000);
        } else {
          buttonElement.style.backgroundColor = "#099268";
          setTimeout(() => {
            buttonElement.textContent = originalText;
            buttonElement.style.backgroundColor = "#5469d4";
          }, 1000);
        }
      }
      function copyField(text, buttonElement) {
        const textarea = document.createElement("textarea");
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand("copy");
        document.body.removeChild(textarea);
        const originalText = buttonElement.textContent;
        const originalBg = buttonElement.style.backgroundColor;
        buttonElement.textContent = "✓";
        buttonElement.style.backgroundColor = "#099268";
        setTimeout(() => {
          buttonElement.textContent = originalText;
          buttonElement.style.backgroundColor = originalBg;
        }, 800);
      }
      function copyFieldFromData(buttonElement) {
        const text = buttonElement.getAttribute("data-copy-text");
        if (!text) return;
        const textarea = document.createElement("textarea");
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand("copy");
        document.body.removeChild(textarea);
        const originalText = buttonElement.textContent;
        const originalColor = buttonElement.style.color;
        buttonElement.textContent = "✓";
        buttonElement.style.color = "#099268";
        setTimeout(() => {
          buttonElement.textContent = originalText;
          buttonElement.style.color = originalColor;
        }, 800);
      }

      const TOOL_FILTER = 'unlock';
      function deriveToolType(acc) {
        const tag = (acc?.tool || acc?.type || acc?.category || '').toString().toLowerCase();
        if (tag === 'unlock' || tag === 'amt') return tag;
        const s = `${acc?.username || ''} ${acc?.email || ''}`.toLowerCase();
        if (/\bamt\b/.test(s) || s.includes('@amt')) return 'amt';
        return 'unlock';
      }
      function isUnlock(acc) { return deriveToolType(acc) === TOOL_FILTER; }
      class AccountManager {
        constructor(accounts = []) {
          this.accounts = accounts.length ? accounts : this.createDefaultAccounts();
          this.lastRentedIndex = -1;
          this.selectedEmail = "";
          this.selectedPassword = "";
          this.searchQuery = "";
          this.resetTimers = {};
          this.sortByExpiration = false;
          firebase
            .database()
            .ref("accounts")
            .on("value", (snapshot) => {
              const savedAccounts = snapshot.val();
              if (savedAccounts) {
                this.accounts = savedAccounts;
                this.renderAccounts();
                this.populateEmailFilter();
                this.populatePasswordFilter();
              }
            });
          this.loadAccounts();
        }
        
        createDefaultAccounts() {
          const defaultAccounts = [];
          for (let i = 1; i <= 6; i++) {
            defaultAccounts.push({
              id: i,
              name: `Akun ${i}`,
              username: "",
              password: "wawawa666",
              email: "",
              availableAt: null,
              expirationDate: "",
              isReady: true
            });
          }
          return defaultAccounts;
        }
        addAccount() {
          const validIds = this.accounts.map((account) => account.id).filter((id) => typeof id === "number" && !isNaN(id));
          const newId = validIds.length > 0 ? Math.max(...validIds) + 1 : 1;
          if (typeof newId !== "number" || isNaN(newId)) {
            this.showNotification("Error: Tidak dapat menentukan ID untuk akun baru");
            return;
          }
          const newAccount = {
            id: newId,
            name: `Akun ${newId}`,
            username: `akun${newId}`,
            password: "wawawa666",
            email: "",
            availableAt: null,
            expirationDate: "",
            isReady: false
          };
          this.accounts.unshift(newAccount);
          this.saveAccounts();
          this.populateEmailFilter();
          this.renderAccounts();
          window.scrollTo({ top: 0, behavior: "smooth" });
          this.showNotification(`Akun baru (Akun ${newId}) telah ditambahkan`);
        }
        saveAccounts() {
          firebase
            .database()
            .ref("accounts")
            .set(this.accounts)
            .then(() => {
              this.syncWithDatabase();
            })
            .catch(() => {
              localStorage.setItem("unlockToolAccounts", JSON.stringify(this.accounts));
            });
        }
        loadAccounts() {
          firebase
            .database()
            .ref("accounts")
            .once("value")
            .then((snapshot) => {
              const savedAccounts = snapshot.val();
              if (savedAccounts) {
                this.accounts = savedAccounts;
              } else {
                const localAccounts = localStorage.getItem("unlockToolAccounts");
                if (localAccounts) {
                  this.accounts = JSON.parse(localAccounts);
                  this.saveAccounts();
                } else {
                  this.accounts = this.createDefaultAccounts();
                }
              }
              this.cleanupAccountData();
              this.renderAccounts();
              this.populateEmailFilter();
              this.populatePasswordFilter();
            })
            .catch(() => {
              const savedAccounts = localStorage.getItem("unlockToolAccounts");
              this.accounts = savedAccounts ? JSON.parse(savedAccounts) : this.createDefaultAccounts();
              this.cleanupAccountData();
              this.renderAccounts();
              this.populateEmailFilter();
              this.populatePasswordFilter();
            });
        }
        cleanupAccountData() {
          this.accounts = this.accounts.filter((account) => account && typeof account === "object");
          let nextId = 1;
          this.accounts.forEach((account, index) => {
            if (typeof account.id !== "number" || isNaN(account.id)) {
              account.id = nextId;
            }
            nextId = Math.max(nextId, account.id) + 1;
          });
          const usedIds = new Set();
          this.accounts.forEach((account) => {
            if (usedIds.has(account.id)) {
              account.id = nextId++;
            }
            usedIds.add(account.id);
          });
          if (this.accounts.some((account) => typeof account.id !== "number" || isNaN(account.id))) {
            this.saveAccounts();
          }
        }
        updateAccount(index, data) {
          this.accounts[index] = { ...this.accounts[index], ...data };
          this.saveAccounts();
          if ("email" in data) this.populateEmailFilter();
          if ("password" in data) this.populatePasswordFilter();
          this.renderAccounts();
        }
        rentAccount(index, hours) {
          const now = new Date();
          let additionalBuffer = 0;
          if (hours === 6) additionalBuffer = 15 * 60 * 1000;
          const availableAt = new Date(now.getTime() + hours * 60 * 60 * 1000 + additionalBuffer);
          this.updateAccount(index, {
            availableAt: availableAt.toISOString(),
            lastRentedHours: hours,
            manuallyUpdated: false
          });
          this.copyInfoWithTime(index);
          this.lastRentedIndex = index;
          setTimeout(() => {
            this.renderAccounts(true);
            this.lastRentedIndex = -1;
          }, 100);
        }
        updateRentTime(index) {
          if (this.resetTimers[index]) {
            clearTimeout(this.resetTimers[index]);
            delete this.resetTimers[index];
          }
          const account = this.accounts[index];
          if (!account.lastRentedHours) return;
          const now = new Date();
          const hours = account.lastRentedHours;
          const availableAt = new Date(now.getTime() + hours * 60 * 60 * 1000);
          this.updateAccount(index, {
            availableAt: availableAt.toISOString(),
            manuallyUpdated: true
          });
          this.copyInfoWithTime(index);
          this.searchQuery = "";
          const searchInput = document.getElementById("usernameSearch");
          if (searchInput) searchInput.value = "";
          const clearButton = document.getElementById("clearSearch");
          if (clearButton) clearButton.style.display = "none";
          this.renderAccounts();
        }
        setManualRentTime(index, dateTime) {
          if (this.resetTimers[index]) {
            clearTimeout(this.resetTimers[index]);
            delete this.resetTimers[index];
          }
          this.updateAccount(index, {
            availableAt: dateTime.toISOString(),
            lastRentedHours: Math.round((dateTime - new Date()) / (1000 * 60 * 60)),
            manuallyUpdated: true
          });
          this.copyInfoWithTime(index);
          this.searchQuery = "";
          const searchInput = document.getElementById("usernameSearch");
          if (searchInput) searchInput.value = "";
          const clearButton = document.getElementById("clearSearch");
          if (clearButton) clearButton.style.display = "none";
          this.renderAccounts();
        }
        resetAccount(index) {
          this.updateAccount(index, {
            availableAt: new Date().toISOString(),
            manuallyUpdated: false
          });
          this.clearSearchBox();
          this.renderAccounts();
        }
        markAccountAsReady(index) {
          this.updateAccount(index, { isReady: true, manuallyUpdated: true });
          this.showNotification("Akun telah siap digunakan");
        }
        isAccountAvailable(account) {
          if (!account.isReady) return false;
          if (!account.availableAt) return true;
          const now = new Date();
          const availableAt = new Date(account.availableAt);
          return now >= availableAt;
        }
        clearSearchBox() {
          this.searchQuery = "";
          const searchInput = document.getElementById("usernameSearch");
          const clearButton = document.getElementById("clearSearch");
          if (searchInput) searchInput.value = "";
          if (clearButton) clearButton.style.display = "none";
        }
        renderAccounts(sort = true) {
  const container = document.getElementById("accountsContainer");
  if (!container) return;

  container.innerHTML = "";

  // Only Unlock Tool accounts + basic sanity checks
  let filteredAccounts = this.accounts.filter((account) =>
    account &&
    isUnlock(account) &&
    account.username &&
    account.username.trim() !== "" &&
    account.password &&
    account.password.trim() !== ""
  );

  if (this.selectedEmail) {
    filteredAccounts = filteredAccounts.filter((account) => account.email === this.selectedEmail);
  }
  if (this.selectedPassword) {
    filteredAccounts = filteredAccounts.filter((account) => account.password === this.selectedPassword);
  }
  if (this.searchQuery) {
    const query = this.searchQuery.toLowerCase();
    filteredAccounts = filteredAccounts.filter((account) => account.username.toLowerCase().includes(query));
  }

  const availableAccounts = filteredAccounts.filter((account) => this.isAccountAvailable(account)).length;

  const totalAccountsEl = document.getElementById("totalAccounts");
  const availableAccountsEl = document.getElementById("availableAccounts");
  if (totalAccountsEl) totalAccountsEl.textContent = filteredAccounts.length;
  if (availableAccountsEl) availableAccountsEl.textContent = availableAccounts;

  const quickRentBtn = document.getElementById("quickRentBtn");
  const quickRent9Btn = document.getElementById("quickRent9Btn");
  const quickRent12Btn = document.getElementById("quickRent12Btn");
  const quickRent24Btn = document.getElementById("quickRent24Btn");
  if (quickRentBtn) quickRentBtn.style.display = availableAccounts > 0 ? "block" : "none";
  if (quickRent9Btn) quickRent9Btn.style.display = availableAccounts > 0 ? "block" : "none";
  if (quickRent12Btn) quickRent12Btn.style.display = availableAccounts > 0 ? "block" : "none";
  if (quickRent24Btn) quickRent24Btn.style.display = availableAccounts > 0 ? "block" : "none";

  if (sort) {
    if (this.sortByExpiration) {
      filteredAccounts.sort((a, b) => {
        const aExpirationPriority = this.getExpirationPriority(a.expirationDate);
        const bExpirationPriority = this.getExpirationPriority(b.expirationDate);
        return aExpirationPriority - bExpirationPriority;
      });
    } else {
      filteredAccounts.sort((a, b) => {
        if (!a.isReady && b.isReady) return -1;
        if (a.isReady && !b.isReady) return 1;
        if (!a.isReady && !b.isReady) return (a.username || a.name).localeCompare(b.username || b.name);

        const aAvailable = this.isAccountAvailable(a);
        const bAvailable = this.isAccountAvailable(b);
        const aAvailable100 = aAvailable && a.manuallyUpdated;
        const bAvailable100 = bAvailable && b.manuallyUpdated;
        const aAvailableNormal = aAvailable && !a.manuallyUpdated;
        const bAvailableNormal = bAvailable && !b.manuallyUpdated;

        if (aAvailable && !bAvailable) return -1;
        if (!aAvailable && bAvailable) return 1;

        if (aAvailable100 && bAvailableNormal) return -1;
        if (aAvailableNormal && bAvailable100) return 1;

        if (aAvailable100 && bAvailable100) {
          const aTime = a.availableAt ? new Date(a.availableAt).getTime() : 0;
          const bTime = b.availableAt ? new Date(b.availableAt).getTime() : 0;
          return aTime - bTime;
        }
        if (aAvailableNormal && bAvailableNormal) {
          const aTime = a.availableAt ? new Date(a.availableAt).getTime() : 0;
          const bTime = b.availableAt ? new Date(b.availableAt).getTime() : 0;
          return aTime - bTime;
        }

        const aTime = new Date(a.availableAt).getTime();
        const bTime = new Date(b.availableAt).getTime();
        return aTime - bTime;
      });
    }
  }

  filteredAccounts.forEach((account) => {
    const realIndex = this.accounts.indexOf(account);
    const isAvailable = this.isAccountAvailable(account);
    const availableAtText = isAvailable ? "Available" : formatDateTime(account.availableAt);
    const remainingTime = !isAvailable ? getRemainingTime(account.availableAt) : null;

    const statusText = !account.isReady
      ? "Not Ready"
      : isAvailable
      ? (account.manuallyUpdated ? "Available 100%" : "Available")
      : account.manuallyUpdated
      ? "Rented 100%"
      : "Rented";

    const detailStatusText = !account.isReady
      ? "Akun belum siap digunakan"
      : isAvailable
      ? (account.manuallyUpdated ? "Available 100%" : "Available")
      : (account.manuallyUpdated ? "Rented 100% until " : "Rented until ") + availableAtText;

    const accountCard = document.createElement("div");
    accountCard.className = "account-card";
    if (realIndex === this.lastRentedIndex) accountCard.classList.add("highlight");

    accountCard.innerHTML = `
      <div class="account-header">
        <div class="account-header-left">
          <button class="delete-account-btn" title="Hapus akun ini" onclick="accountManager.deleteAccount(${realIndex})">🗑️</button>
          <h2>${account.username ? account.username : account.name}</h2>
        </div>
        <span class="status ${!account.isReady ? "not-ready" : isAvailable ? "available" : "rented"}">${statusText}</span>
      </div>
      <div class="account-body">
        <div class="form-group">
          <label for="username-${realIndex}">Username/Login:</label>
          <div class="input-with-copy">
            <button class="small-copy-btn" data-copy-text="${account.username}" onclick="copyFieldFromData(this)" title="Copy Username">📋</button>
            <input type="text" id="username-${realIndex}" value="${account.username}" onchange="accountManager.updateAccount(${realIndex}, {username: this.value})">
          </div>
        </div>
        <div class="form-group">
          <label for="password-${realIndex}">Password:</label>
          <div class="input-with-copy">
            <button class="small-copy-btn" data-copy-text="${account.password}" onclick="copyFieldFromData(this)" title="Copy Password">📋</button>
            <input type="text" id="password-${realIndex}" value="${account.password}" onchange="accountManager.updateAccount(${realIndex}, {password: this.value})">
          </div>
        </div>
        <div class="form-group">
          <label for="email-${realIndex}">Email:</label>
          <div class="input-with-copy">
            <button class="small-copy-btn" data-copy-text="${account.email || ""}" onclick="copyFieldFromData(this)" title="Copy Email">📋</button>
            <input type="text" id="email-${realIndex}" value="${account.email || ""}" onchange="accountManager.updateAccount(${realIndex}, {email: this.value})">
          </div>
        </div>
        <div class="form-group">
          <label for="expiration-${realIndex}">Account Expiration:</label>
          <div style="display: flex; align-items: center; gap: 8px;">
            <input type="text" id="expiration-${realIndex}" value="${account.expirationDate || ""}" placeholder="Nov. 9, 2025, 5:32 a.m." onchange="accountManager.updateAccount(${realIndex}, {expirationDate: this.value})" style="flex: 1; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-family: 'Poppins', sans-serif; font-size: 0.9rem;">
            ${account.expirationDate ? this.getExpirationInfoInline(account.expirationDate) : '<span style="font-size: 0.85rem; color: #666; white-space: nowrap;">Belum diset</span>'}
          </div>
        </div>
        <div class="time-info">
          <strong>Status:</strong> ${detailStatusText}
          ${remainingTime ? `<div><strong>Remaining:</strong> ${remainingTime}</div>` : ""}
        </div>
        <div class="btn-container">
          ${
            !account.isReady
              ? `
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                  <button class="ready-btn" style="flex: 1;" onclick="accountManager.markAccountAsReady(${realIndex})">Account is Ready</button>
                  <button class="reset-btn" style="flex: 1;" onclick="accountManager.resetAccount(${realIndex})">Reset</button>
                </div>
              `
              : `
                <div class="btn-group duration-buttons">
                  <button class="rent-btn" onclick="accountManager.rentAccount(${realIndex}, 6)">6 Jam</button>
                  <button class="rent-btn" onclick="accountManager.rentAccount(${realIndex}, 9)">9 Jam</button>
                  <button class="rent-btn" onclick="accountManager.rentAccount(${realIndex}, 12)">12 Jam</button>
                  <button class="rent-btn" onclick="accountManager.rentAccount(${realIndex}, 24)">24 Jam</button>
                </div>
                <div class="btn-group control-buttons">
                  <button class="manual-btn" onclick="openManualInput(${realIndex})">Manual</button>
                  <button class="reset-btn" onclick="accountManager.autoResetWithDelay(${realIndex})">Reset</button>
                  ${
                    !isAvailable
                      ? account.lastRentedHours === 6
                        ? `<button class="update-btn" onclick="accountManager.updateRentTime(${realIndex})">Update Waktu</button>`
                        : `<button class="update-btn btn-disabled" disabled>Update Waktu</button>`
                      : ""
                  }
                </div>
              `
          }
        </div>
      </div>
    `;
    container.appendChild(accountCard);
  });

  this.populateEmailFilter();
}
        copyInfoWithTime(accountIndex) {
          const account = this.accounts[accountIndex];
          const isAvailable = this.isAccountAvailable(account);
          let infoText = `Username: ${account.username}\nPassword: ${account.password}`;
          if (!isAvailable && account.availableAt) {
            const now = new Date();
            const hours = account.lastRentedHours || 6;
            const actualEndTime = new Date(now.getTime() + hours * 60 * 60 * 1000);
            let endHours = actualEndTime.getHours();
            let endMinutes = String(actualEndTime.getMinutes()).padStart(2, "0");
            if (endMinutes === "08") endMinutes = "09";
            infoText += `\nWaktu sewa sampai jam ${endHours}:${endMinutes} WIB (${hours} jam dari sekarang)`;
          }
          infoText += `\n\n- Wajib login dalam kurun waktu 1 jam`;
          const hours = account.lastRentedHours || 6;
          if (hours === 6) infoText += `\n- Mohon di-infokan kepada kami jika sudah berhasil login`;
          const textarea = document.createElement("textarea");
          textarea.value = infoText;
          document.body.appendChild(textarea);
          textarea.select();
          document.execCommand("copy");
          document.body.removeChild(textarea);
          this.showNotification("Informasi akun telah disalin ke clipboard");
          if (accountIndex === this.lastRentedIndex) {
            this.lastRentedIndex = -1;
            setTimeout(() => this.renderAccounts(), 1500);
          }
        }
        showNotification(message) {
          const notification = document.getElementById("notification");
          notification.textContent = message;
          notification.classList.add("show");
          setTimeout(() => {
            notification.classList.remove("show");
          }, 3000);
        }
        exportData() {
          const dataStr = JSON.stringify(this.accounts);
          const blob = new Blob([dataStr], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          const date = new Date();
          const timestamp = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, "0")}-${String(date.getDate()).padStart(2, "0")}_${String(date.getHours()).padStart(2, "0")}${String(date.getMinutes()).padStart(2, "0")}`;
          a.download = `unlock-tool-accounts-${timestamp}.json`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
          this.showNotification("Data akun berhasil diekspor ke file JSON");
        }
        importData(file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            try {
              const importedAccounts = JSON.parse(event.target.result);
              if (!Array.isArray(importedAccounts)) throw new Error("Format data tidak valid");
              this.accounts = importedAccounts;
              this.saveAccounts();
              this.populateEmailFilter();
              this.renderAccounts();
              this.showNotification("Data akun berhasil diimpor");
            } catch (error) {
              this.showNotification("Gagal mengimpor data: " + error.message);
            }
          };
          reader.readAsText(file);
        }
        populateEmailFilter() {
          const emailFilter = document.getElementById("emailFilter");
          const customOptions = emailFilter.querySelector(".custom-options");

          while (customOptions.children.length > 1) {
            customOptions.removeChild(customOptions.lastChild);
          }

          // Only Unlock Tool accounts
          const base = this.accounts.filter((acc) => isUnlock(acc));

          const emails = base
            .filter((account) => account.email && account.email.trim() !== "")
            .map((account) => account.email);

          const emailsByDomain = {};
          emails.forEach((email) => {
            const parts = email.split("@");
            if (parts.length === 2) {
              const domain = parts[1];
              if (!emailsByDomain[domain]) emailsByDomain[domain] = [];
              if (!emailsByDomain[domain].includes(email)) emailsByDomain[domain].push(email);
            }
          });

          const sortedDomains = Object.keys(emailsByDomain).sort();
          sortedDomains.forEach((domain) => {
            const sortedEmails = emailsByDomain[domain].sort();
            sortedEmails.forEach((email) => {
              const totalAccounts = base.filter((account) => account.email === email).length;
              const availableAccounts = base.filter((account) => account.email === email && this.isAccountAvailable(account)).length;
              const option = document.createElement("div");
              option.className = "custom-option";
              option.setAttribute("data-value", email);
              option.innerHTML = `${email} (<span class="email-counter-available">${availableAccounts}</span>/<span class="email-counter-total">${totalAccounts}</span>)`;
              customOptions.appendChild(option);
            });
          });

          this.updateCustomSelectValue(this.selectedEmail);
        }
        updateCustomSelectValue(value) {
          const emailFilter = document.getElementById("emailFilter");
          const selectTrigger = emailFilter.querySelector(".select-trigger span");
          const customOptions = emailFilter.querySelectorAll(".custom-option");
          if (value === "") {
            selectTrigger.textContent = "Semua Email";
          } else {
            const selectedOption = [...customOptions].find((opt) => opt.getAttribute("data-value") === value);
            if (selectedOption) selectTrigger.innerHTML = selectedOption.innerHTML;
          }
          customOptions.forEach((opt) => {
            if (opt.getAttribute("data-value") === value) opt.classList.add("selected");
            else opt.classList.remove("selected");
          });
        }
        setEmailFilter(email) {
          this.selectedEmail = email;
          this.renderAccounts();
          if (email && email.trim() !== "") this.copyEmailToClipboard(email);
          this.updateCustomSelectValue(email);
        }
        copyEmailToClipboard(email) {
          const textarea = document.createElement("textarea");
          textarea.value = email;
          document.body.appendChild(textarea);
          textarea.select();
          document.execCommand("copy");
          document.body.removeChild(textarea);
          this.showNotification(`📧 Email "${email}" telah disalin ke clipboard`);
        }
        getExpirationInfo(expirationDate) {
          if (!expirationDate) return "";
          const today = new Date();
          let expDate;
          try {
            expDate = new Date(expirationDate);
            if (isNaN(expDate.getTime())) {
              const cleanDate = expirationDate.replace(/\./g, "").replace(/,/g, "");
              expDate = new Date(cleanDate);
            }
            if (isNaN(expDate.getTime())) {
              return '<div style="font-size: 0.85rem; color: #e03131; margin-top: 5px; font-weight: 600;">Format tanggal tidak valid</div>';
            }
          } catch (error) {
            return '<div style="font-size: 0.85rem; color: #e03131; margin-top: 5px; font-weight: 600;">Format tanggal tidak valid</div>';
          }
          const diffTime = expDate - today;
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
          let statusText = "";
          let statusColor = "";
          if (diffDays < 0) {
            statusText = `Expired ${Math.abs(diffDays)} hari yang lalu`;
            statusColor = "#e03131";
          } else if (diffDays === 0) {
            statusText = "Expired hari ini";
            statusColor = "#e03131";
          } else if (diffDays <= 7) {
            statusText = `${diffDays} hari lagi (Segera expired!)`;
            statusColor = "#f59f00";
          } else if (diffDays <= 30) {
            statusText = `${diffDays} hari lagi`;
            statusColor = "#f59f00";
          } else {
            statusText = `${diffDays} hari lagi`;
            statusColor = "#0ca678";
          }
          return `<div style="font-size: 0.85rem; color: ${statusColor}; margin-top: 5px; font-weight: 600;">${statusText}</div>`;
        }
        getExpirationInfoInline(expirationDate) {
          if (!expirationDate) return "";
          const today = new Date();
          let expDate;
          try {
            expDate = new Date(expirationDate);
            if (isNaN(expDate.getTime())) {
              const cleanDate = expirationDate.replace(/\./g, "").replace(/,/g, "");
              expDate = new Date(cleanDate);
            }
            if (isNaN(expDate.getTime())) {
              return '<span style="font-size: 0.85rem; color: #e03131; font-weight: 600; white-space: nowrap;">Format salah</span>';
            }
          } catch (error) {
            return '<span style="font-size: 0.85rem; color: #e03131; font-weight: 600; white-space: nowrap;">Format salah</span>';
          }
          const diffTime = expDate - today;
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
          let statusText = "";
          let statusColor = "";
          if (diffDays < 0) {
            statusText = `Expired ${Math.abs(diffDays)} hari lalu`;
            statusColor = "#e03131";
          } else if (diffDays === 0) {
            statusText = "Expired hari ini";
            statusColor = "#e03131";
          } else if (diffDays <= 7) {
            statusText = `${diffDays} hari lagi!`;
            statusColor = "#f59f00";
          } else if (diffDays <= 30) {
            statusText = `${diffDays} hari lagi`;
            statusColor = "#f59f00";
          } else {
            statusText = `${diffDays} hari lagi`;
            statusColor = "#0ca678";
          }
          return `<span style="font-size: 0.85rem; color: ${statusColor}; font-weight: 600; white-space: nowrap;">${statusText}</span>`;
        }
        getExpirationPriority(expirationDate) {
          if (!expirationDate) return 999;
          const today = new Date();
          let expDate;
          try {
            expDate = new Date(expirationDate);
            if (isNaN(expDate.getTime())) {
              const cleanDate = expirationDate.replace(/\./g, "").replace(/,/g, "");
              expDate = new Date(cleanDate);
            }
            if (isNaN(expDate.getTime())) return 998;
          } catch (error) {
            return 998;
          }
          const diffTime = expDate - today;
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
          if (diffDays < 0) return 1;
          if (diffDays === 0) return 2;
          if (diffDays <= 7) return 3;
          if (diffDays <= 30) return 4;
          return 100 + diffDays;
        }
        toggleSortByExpiration() {
          this.sortByExpiration = !this.sortByExpiration;
          const sortBtn = document.getElementById("sortByExpirationBtn");
          if (this.sortByExpiration) {
            sortBtn.classList.add("active");
            sortBtn.textContent = "📅 Sort Normal";
            this.showNotification("Sorting berdasarkan expiration date");
          } else {
            sortBtn.classList.remove("active");
            sortBtn.textContent = "📅 Sort Expiration";
            this.showNotification("Sorting normal (default)");
          }
          this.renderAccounts(true);
        }
        moveToNextEmail() {
          const emailFilter = document.getElementById("emailFilter");
          const customOptions = emailFilter.querySelectorAll(".custom-option");
          const availableEmails = [];
          customOptions.forEach((option) => {
            const value = option.getAttribute("data-value");
            if (value && value.trim() !== "") availableEmails.push(value);
          });
          if (availableEmails.length === 0) {
            this.showNotification("Tidak ada email yang tersedia untuk dipindah");
            return;
          }
          let currentIndex = -1;
          if (this.selectedEmail) currentIndex = availableEmails.indexOf(this.selectedEmail);
          const nextIndex = (currentIndex + 1) % availableEmails.length;
          const nextEmail = availableEmails[nextIndex];
          this.setEmailFilter(nextEmail);
        }
        setSearchQuery(query) {
          this.searchQuery = query;
          this.renderAccounts();
        }
        quickRent(hours = 6) {
          const rentBtnId = hours === 6 ? "quickRentBtn" : hours === 9 ? "quickRent9Btn" : hours === 12 ? "quickRent12Btn" : "quickRent24Btn";
          const rentBtn = document.getElementById(rentBtnId);
          if (rentBtn?.disabled) return;

          // Only Unlock Tool accounts
          const availableAccounts = this.accounts.filter((account) =>
            isUnlock(account) &&
            this.isAccountAvailable(account) &&
            account.username &&
            account.username.trim() !== "" &&
            account.password &&
            account.password.trim() !== ""
          );

          if (availableAccounts.length === 0) {
            this.showNotification("Tidak ada akun yang tersedia untuk disewa!");
            return;
          }

          const available100Accounts = availableAccounts.filter((account) => account.manuallyUpdated);
          let accountToRent;
          if (available100Accounts.length > 1) {
            accountToRent = available100Accounts[0];
            this.showNotification(`Menyewa akun Available 100% untuk ${hours} jam: ${accountToRent.username}`);
          } else if (available100Accounts.length === 1 && availableAccounts.length > 1) {
            accountToRent = availableAccounts.find((account) => !account.manuallyUpdated);
            this.showNotification(`Menyewa akun available biasa untuk ${hours} jam: ${accountToRent.username} (menyisakan 1 akun Available 100%)`);
          } else {
            accountToRent = availableAccounts[0];
            this.showNotification(`Menyewa akun available untuk ${hours} jam: ${accountToRent.username}`);
          }

          const accountIndex = this.accounts.indexOf(accountToRent);
          if (accountIndex !== -1) {
            this.rentAccount(accountIndex, hours);
            this.enableClickProtection(rentBtnId);
          }
        }
        enableClickProtection(buttonId = "quickRentBtn") {
          const quickRentBtn = document.getElementById(buttonId);
          const originalText = quickRentBtn.textContent;
          const cooldownTime = 3;
          quickRentBtn.disabled = true;
          quickRentBtn.style.backgroundColor = "#adb5bd";
          quickRentBtn.style.cursor = "not-allowed";
          let countdown = cooldownTime;
          quickRentBtn.textContent = `Tunggu (${countdown})`;
          const timer = setInterval(() => {
            countdown--;
            quickRentBtn.textContent = `Tunggu (${countdown})`;
            if (countdown <= 0) {
              clearInterval(timer);
              quickRentBtn.disabled = false;
              quickRentBtn.textContent = originalText;
              quickRentBtn.style.backgroundColor = "";
              quickRentBtn.style.cursor = "";
            }
          }, 1000);
        }
        deleteAccount(index) {
          const acc = this.accounts[index];
          const title = (acc.username && acc.username.trim() !== "") ? acc.username : (acc.name || `Akun ${acc.id}`);
          if (confirm(`Apakah Anda yakin ingin menghapus ${title}?`)) {
            this.accounts.splice(index, 1);
            this.saveAccounts();
            this.populateEmailFilter();
            this.renderAccounts();
            this.showNotification("Akun berhasil dihapus");
          }
        }
        syncWithDatabase() {
          fetch("https://shopee.seninselasatechno.com/accounts-sync/sync-from-frontend", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ accounts: this.accounts })
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                this.showNotification(`✅ Sinkronisasi berhasil (${data.result.inserted} ditambahkan, ${data.result.updated} diperbarui)`);
              } else {
                this.showNotification("❌ Gagal menyinkronkan akun ke database");
              }
            })
            .catch(() => {
              this.showNotification("❌ Gagal terhubung ke server");
            });
        }
        resetAllAvailable() {
          // Only Unlock Tool accounts
          const availableIndices = this.accounts
            .map((acc, i) => (isUnlock(acc) && this.isAccountAvailable(acc) ? i : null))
            .filter((i) => i !== null);

          if (availableIndices.length === 0) {
            this.showNotification("Tidak ada akun available untuk direset");
            return;
          }

          let rentedCount = 0;
          availableIndices.forEach((idx) => {
            const account = this.accounts[idx];
            if (account.availableAt) rentedCount++;
          });

          availableIndices.forEach((idx) => {
            const wasManual = this.accounts[idx].manuallyUpdated;
            this.updateAccount(idx, { availableAt: null, manuallyUpdated: wasManual });
          });

          document.getElementById("lastResetTime").textContent = formatHHMM(new Date());
          this.showNotification(`Auto-reset ${availableIndices.length} akun selesai`);
        }
        autoResetWithDelay(index) {
          const account = this.accounts[index];
          const wasManual = account.manuallyUpdated;
          this.updateAccount(index, { availableAt: null, manuallyUpdated: wasManual });
          this.clearSearchBox();
          this.renderAccounts();
        }
        manualReset(index) {
          if (this.resetTimers[index]) {
            clearTimeout(this.resetTimers[index]);
            delete this.resetTimers[index];
          }
          this.resetAccount(index);
          this.clearSearchBox();
        }
        populatePasswordFilter() {
          this.renderPasswordList();
        }
        setPasswordFilter(password) {
          if (this.selectedPassword === password) {
            this.selectedPassword = "";
            document.querySelectorAll(".password-card").forEach((card) => card.classList.remove("active"));
            this.renderAccounts();
            return;
          }
          this.selectedPassword = password;
          const passwordCards = document.querySelectorAll(".password-card");
          passwordCards.forEach((card) => {
            if (card.getAttribute("data-password") === password) {
              card.classList.add("active");
            } else {
              card.classList.remove("active");
            }
          });
          this.renderAccounts();
          this.populatePasswordFilter();
        }
        renderPasswordList() {
          const container = document.getElementById("passwordListContainer");
          if (!container) return;

          container.innerHTML = "";

          // Only Unlock Tool accounts
          const base = this.accounts.filter((acc) => isUnlock(acc));

          const passwords = Array.from(
            new Set(
              base
                .filter((acc) => acc.password && acc.password.trim() !== "")
                .map((acc) => acc.password)
            )
          ).sort();

          passwords.forEach((pwd) => {
            const item = document.createElement("div");
            item.className = "password-card";
            if (pwd === this.selectedPassword) item.classList.add("active");
            item.setAttribute("data-password", pwd);
            item.innerHTML = `
              <span title="Klik untuk filter password ini">${pwd}</span>
              <button class="delete-btn" title="Hapus password ini dari semua akun">&times;</button>
            `;
            const span = item.querySelector("span");
            span.addEventListener("click", () => {
              this.setPasswordFilter(pwd);
            });
            const btn = item.querySelector(".delete-btn");
            btn.addEventListener("click", (e) => {
              e.stopPropagation();
              if (confirm(`Hapus password '${pwd}' dari semua akun?`)) {
                this.deletePasswordFromAllAccounts(pwd);
              }
            });
            container.appendChild(item);
          });

          if (!this.passwordSortable) {
            this.passwordSortable = new Sortable(container, {
              animation: 150,
              ghostClass: "sortable-ghost",
              chosenClass: "sortable-chosen",
              dragClass: "sortable-drag",
              easing: "cubic-bezier(0.2, 0, 0.13, 2)",
              delay: 50,
              delayOnTouchOnly: true,
              touchStartThreshold: 3,
              onEnd: () => {
                this.showNotification("Posisi password berhasil diubah");
                const passwords = Array.from(container.children).map((el) => el.getAttribute("data-password"));
                localStorage.setItem("passwordOrder", JSON.stringify(passwords));
              }
            });
          }

          const savedOrder = localStorage.getItem("passwordOrder");
          if (savedOrder) {
            try {
              const orderArray = JSON.parse(savedOrder);
              [...container.children]
                .sort((a, b) => {
                  const aIndex = orderArray.indexOf(a.getAttribute("data-password"));
                  const bIndex = orderArray.indexOf(b.getAttribute("data-password"));
                  if (aIndex === -1) return 1;
                  if (bIndex === -1) return -1;
                  return aIndex - bIndex;
                })
                .forEach((node) => container.appendChild(node));
            } catch (e) {}
          }
        }

        deletePasswordFromAllAccounts(pwd) {
          let changed = false;
          this.accounts.forEach((acc, i) => {
            if (isUnlock(acc) && acc.password === pwd) {
              this.updateAccount(i, { password: "" });
              changed = true;
            }
          });
          if (changed) {
            this.showNotification(`Password '${pwd}' dihapus dari semua akun.`);
            this.populatePasswordFilter();
            this.renderPasswordList();
          }
        }
      }
      let accountManager;
      let currentAccountIndex = -1;
      function openManualInput(accountIndex) {
        currentAccountIndex = accountIndex;
        const today = new Date();
        const dateInput = document.getElementById("manualDate");
        const timeInput = document.getElementById("manualTime");
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, "0");
        const day = String(today.getDate()).padStart(2, "0");
        dateInput.value = `${year}-${month}-${day}`;
        const hours = String(today.getHours()).padStart(2, "0");
        const minutes = String(today.getMinutes()).padStart(2, "0");
        timeInput.value = `${hours}:${minutes}`;
        const modal = document.getElementById("manualModal");
        modal.style.display = "block";
      }
      function closeManualModal() {
        const modal = document.getElementById("manualModal");
        modal.style.display = "none";
        currentAccountIndex = -1;
      }
      function toggleTimeInputType() {
        const exactInputs = document.getElementById("exactTimeInputs");
        const durationInputs = document.getElementById("durationInputs");
        const inputType = document.querySelector('input[name="timeInputType"]:checked').value;
        if (inputType === "exact") {
          exactInputs.style.display = "block";
          durationInputs.style.display = "none";
        } else {
          exactInputs.style.display = "none";
          durationInputs.style.display = "block";
        }
      }
      function saveManualTime() {
        if (currentAccountIndex === -1) return;
        const inputType = document.querySelector('input[name="timeInputType"]:checked').value;
        let dateTime;
        if (inputType === "exact") {
          const dateInput = document.getElementById("manualDate").value;
          const timeInput = document.getElementById("manualTime").value;
          if (!dateInput || !timeInput) {
            alert("Mohon isi tanggal dan waktu!");
            return;
          }
          dateTime = new Date(`${dateInput}T${timeInput}`);
        } else {
          const hours = parseInt(document.getElementById("durationHours").value) || 0;
          const minutes = parseInt(document.getElementById("durationMinutes").value) || 0;
          if (hours === 0 && minutes === 0) {
            alert("Mohon masukkan durasi yang valid!");
            return;
          }
          const now = new Date();
          dateTime = new Date(now.getTime() + hours * 60 * 60 * 1000 + minutes * 60 * 1000);
        }
        accountManager.setManualRentTime(currentAccountIndex, dateTime);
        closeManualModal();
      }
      function processBulkAccounts() {
        if (!accountManager) {
          alert("Error: Account Manager belum diinisialisasi!");
          return;
        }
        const bulkInput = document.getElementById("bulkInput").value.trim();
        if (!bulkInput) {
          alert("Silakan masukkan data akun!");
          return;
        }
        let accountGroups = [];
        if (bulkInput.includes("\n\n")) {
          accountGroups = bulkInput.split(/\n\s*\n+/);
        } else {
          const allLines = bulkInput.split("\n").map((line) => line.trim()).filter((line) => line);
          for (let i = 0; i < allLines.length; i += 2) {
            if (i + 1 < allLines.length) {
              accountGroups.push(allLines[i] + "\n" + allLines[i + 1]);
            }
          }
        }
        let addedCount = 0;
        accountGroups.forEach((group) => {
          const lines = group.trim().split("\n");
          if (lines.length >= 2) {
            const username = lines[0].trim();
            const email = lines[1].trim();
            const isValidEmail = email.includes("@") && email.includes(".");
            if (username && email && isValidEmail) {
              const validIds = accountManager.accounts.map((account) => account.id).filter((id) => typeof id === "number" && !isNaN(id));
              const newId = validIds.length > 0 ? Math.max(...validIds) + 1 : 1;
              if (typeof newId !== "number" || isNaN(newId)) {
                alert("Error: Tidak dapat menentukan ID untuk akun baru");
                return;
              }
              const newAccount = {
                id: newId,
                name: `Akun ${newId}`,
                username: username,
                password: "wawawa666",
                email: email,
                availableAt: null,
                expirationDate: "",
                isReady: false
              };
              accountManager.accounts.unshift(newAccount);
              addedCount++;
            }
          }
        });
        if (addedCount > 0) {
          accountManager.saveAccounts();
          accountManager.populateEmailFilter();
          accountManager.renderAccounts();
          accountManager.showNotification(`${addedCount} akun baru berhasil ditambahkan`);
          closeBulkModal();
          document.getElementById("bulkInput").value = "";
        } else {
          alert("Tidak ada akun valid yang ditemukan. Pastikan format data benar!\n\nFormat yang didukung:\n1. Username\\nEmail\\n\\nUsername2\\nEmail2\n2. Username\\nEmail\\nUsername2\\nEmail2");
        }
      }
      function openBulkModal() {
        const modal = document.getElementById("bulkAddModal");
        modal.style.display = "block";
      }
      function closeBulkModal() {
        const modal = document.getElementById("bulkAddModal");
        modal.style.display = "none";
      }
      function openBulkChangePwdModal() {
        const modal = document.getElementById("bulkChangePwdModal");
        modal.style.display = "block";
      }
      function closeBulkChangePwdModal() {
        document.getElementById("bulkChangePwdModal").style.display = "none";
      }
      function applyBulkChangePwd() {
        const pwd = document.getElementById("newPassword").value.trim();
        const emailFilter = accountManager.selectedEmail;
        if (!pwd) {
          alert("Masukkan password baru");
          return;
        }
        let changedCount = 0;
        accountManager.accounts.forEach((acc, i) => {
          const isAvail = accountManager.isAccountAvailable(acc);
          const emailMatch = !emailFilter || acc.email === emailFilter;
          if (isUnlock(acc) && isAvail && emailMatch) {
            accountManager.updateAccount(i, { password: pwd });
            changedCount++;
          }
        });
        if (changedCount > 0) {
          accountManager.showNotification(`Password diubah untuk ${changedCount} akun available`);
        } else {
          accountManager.showNotification("Tidak ada akun available yang sesuai filter");
        }
        closeBulkChangePwdModal();
      }
      window.addEventListener("click", (event) => {
        const bulkChangePwdModal = document.getElementById("bulkChangePwdModal");
        if (event.target == bulkChangePwdModal) {
          closeBulkChangePwdModal();
        }
      });
      function formatHHMM(date) {
        const h = String(date.getHours()).padStart(2, "0");
        const m = String(date.getMinutes()).padStart(2, "0");
        return `${h}:${m}`;
      }
    </script>
  </body>
</html>
