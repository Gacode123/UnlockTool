<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pengelola Akun Unlock Tool</title>
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" />

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>

    <!-- Tambahkan SortableJS untuk drag n drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>

    <!-- Firebase Config -->
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyBzoi1KKiiXXC5kXQHoTHA8OXBq5mCM1vw",
        authDomain: "unlocktool-5ae45.firebaseapp.com",
        databaseURL: "https://unlocktool-5ae45-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "unlocktool-5ae45",
        storageBucket: "unlocktool-5ae45.firebasestorage.app",
        messagingSenderId: "321966892442",
        appId: "1:321966892442:web:145de4877c642feac30623",
        measurementId: "G-38Y0D6LEF7",
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
    </script>

    <style>
      :root {
        /* Modern Color Palette */
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --warning-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        --danger-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        --purple-gradient: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        --dark-gradient: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        
        /* Glass Effect Colors */
        --glass-bg: rgba(255, 255, 255, 0.1);
        --glass-border: rgba(255, 255, 255, 0.2);
        --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        
        /* Text Colors */
        --text-primary: #2d3748;
        --text-secondary: #4a5568;
        --text-light: #718096;
        --text-white: #ffffff;
        
        /* Modern Effects */
        --border-radius: 20px;
        --border-radius-small: 12px;
        --box-shadow-soft: 0 10px 25px 0 rgba(0, 0, 0, 0.1);
        --box-shadow-hover: 0 20px 40px 0 rgba(0, 0, 0, 0.15);
        --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        --backdrop-filter: blur(20px);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        background-size: 400% 400%;
        animation: gradientShift 15s ease infinite;
        color: var(--text-primary);
        padding: 20px;
        line-height: 1.6;
        position: relative;
        min-height: 100vh;
      }

      @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }

      /* Modern glass container */
      .glass-container {
        background: var(--glass-bg);
        backdrop-filter: var(--backdrop-filter);
        -webkit-backdrop-filter: var(--backdrop-filter);
        border: 1px solid var(--glass-border);
        border-radius: var(--border-radius);
        box-shadow: var(--glass-shadow);
        transition: var(--transition);
      }

      .glass-container:hover {
        transform: translateY(-2px);
        box-shadow: var(--box-shadow-hover);
      }

      /* Version badge with modern styling */
      .version-badge {
        position: fixed;
        top: 20px;
        left: 20px;
        background: var(--primary-gradient);
        color: var(--text-white);
        padding: 12px 20px;
        border-radius: 25px;
        font-size: 0.9rem;
        font-weight: 600;
        z-index: 1000;
        box-shadow: var(--box-shadow-soft);
        cursor: pointer;
        transition: var(--transition);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
      }

      .version-badge:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: var(--box-shadow-hover);
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      /* Modern account summary */
      .account-summary {
        background: var(--glass-bg);
        backdrop-filter: var(--backdrop-filter);
        -webkit-backdrop-filter: var(--backdrop-filter);
        border: 1px solid var(--glass-border);
        padding: 30px;
        border-radius: var(--border-radius);
        margin-bottom: 30px;
        box-shadow: var(--glass-shadow);
        color: var(--text-white);
        font-weight: 500;
      }

      h1 {
        text-align: center;
        font-weight: 700;
        color: var(--text-white);
        margin-bottom: 40px;
        font-size: 3rem;
        text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      /* Modern button styling */
      .modern-btn {
        background: var(--primary-gradient);
        color: var(--text-white);
        padding: 15px 30px;
        border: none;
        border-radius: var(--border-radius-small);
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: var(--transition);
        box-shadow: var(--box-shadow-soft);
        position: relative;
        overflow: hidden;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .modern-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        transition: var(--transition);
      }

      .modern-btn:hover::before {
        left: 100%;
      }

      .modern-btn:hover {
        transform: translateY(-3px);
        box-shadow: var(--box-shadow-hover);
      }

      .buttons-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
      }

      .action-btn {
        background: var(--primary-gradient);
        color: var(--text-white);
        padding: 18px 25px;
        border: none;
        border-radius: var(--border-radius-small);
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: var(--transition);
        box-shadow: var(--box-shadow-soft);
        position: relative;
        overflow: hidden;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .action-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        transition: var(--transition);
      }

      .action-btn:hover::before {
        left: 100%;
      }

      .action-btn:hover {
        transform: translateY(-3px);
        box-shadow: var(--box-shadow-hover);
      }

      .add-btn {
        background: var(--success-gradient);
      }

      .ads-btn {
        background: var(--warning-gradient);
      }

      .export-btn {
        background: var(--primary-gradient);
      }

      .import-btn {
        background: var(--dark-gradient);
        position: relative;
      }

      .danger-btn {
        background: var(--danger-gradient);
      }

      .purple-btn {
        background: var(--purple-gradient);
      }

      .import-btn input[type="file"] {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
      }

      /* Modern account cards */
      .accounts-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 25px;
      }

      .account-card {
        background: var(--glass-bg);
        backdrop-filter: var(--backdrop-filter);
        -webkit-backdrop-filter: var(--backdrop-filter);
        border: 1px solid var(--glass-border);
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--glass-shadow);
        transition: var(--transition);
        position: relative;
      }

      .account-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary-gradient);
        border-radius: var(--border-radius) var(--border-radius) 0 0;
      }

      .account-card.highlight {
        border: 2px solid transparent;
        background: linear-gradient(var(--glass-bg), var(--glass-bg)) padding-box,
                    var(--success-gradient) border-box;
        animation: pulseGlow 2s infinite;
      }

      @keyframes pulseGlow {
        0%, 100% {
          box-shadow: var(--glass-shadow), 0 0 20px rgba(79, 172, 254, 0.5);
        }
        50% {
          box-shadow: var(--glass-shadow), 0 0 30px rgba(79, 172, 254, 0.8);
        }
      }

      .account-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: var(--box-shadow-hover);
      }

      .account-header {
        padding: 25px 30px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(255, 255, 255, 0.05);
      }

      .account-header h2 {
        font-size: 1.4rem;
        font-weight: 700;
        margin: 0;
        color: var(--text-white);
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .copy-info-container {
        padding: 15px 25px;
        background: rgba(255, 255, 255, 0.05);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        text-align: center;
      }

      .primary-copy-btn {
        background: var(--primary-gradient);
        color: var(--text-white);
        padding: 12px 20px;
        font-size: 1rem;
        border-radius: var(--border-radius-small);
        width: 100%;
        font-weight: 600;
        transition: var(--transition);
        box-shadow: var(--box-shadow-soft);
        border: none;
        cursor: pointer;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .primary-copy-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--box-shadow-hover);
      }

      /* Status badges with modern styling */
      .status {
        font-size: 0.85rem;
        font-weight: 600;
        padding: 8px 16px;
        border-radius: 20px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: var(--box-shadow-soft);
      }

      .status.available {
        background: var(--success-gradient);
        color: var(--text-white);
      }

      .status.rented {
        background: var(--danger-gradient);
        color: var(--text-white);
      }

      .status.not-ready {
        background: var(--warning-gradient);
        color: var(--text-white);
      }

      .account-body {
        padding: 25px;
        background: rgba(255, 255, 255, 0.02);
      }

      /* Modern form styling */
      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        font-size: 0.9rem;
        color: var(--text-white);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      input[type="text"],
      input[type="password"] {
        width: 100%;
        padding: 15px 18px;
        border: 2px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--border-radius-small);
        font-family: inherit;
        font-size: 0.95rem;
        transition: var(--transition);
        background: rgba(255, 255, 255, 0.1);
        color: var(--text-white);
        backdrop-filter: blur(10px);
      }

      input[type="text"]::placeholder,
      input[type="password"]::placeholder {
        color: rgba(255, 255, 255, 0.6);
      }

      input[type="text"]:focus,
      input[type="password"]:focus {
        outline: none;
        border-color: rgba(102, 126, 234, 0.8);
        box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        transform: translateY(-2px);
      }

      /* Modern copy buttons */
      .small-copy-btn {
        background: rgba(255, 255, 255, 0.1);
        color: var(--text-white);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        padding: 8px 10px;
        font-size: 1rem;
        cursor: pointer;
        margin-right: 10px;
        transition: var(--transition);
        min-width: 40px;
        height: 40px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: 500;
        backdrop-filter: blur(10px);
      }

      .small-copy-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: scale(1.1);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .input-with-copy {
        display: flex;
        align-items: center;
        gap: 0;
      }

      .input-with-copy input {
        flex: 1;
        margin: 0;
      }

      /* Modern time info */
      .time-info {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        padding: 15px 20px;
        border-radius: var(--border-radius-small);
        margin-bottom: 20px;
        font-size: 0.9rem;
        color: var(--text-white);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .time-info strong {
        color: var(--text-white);
        font-weight: 700;
      }

      /* Modern button groups */
      .btn-container {
        margin-top: 25px;
      }

      .btn-group {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 12px;
        margin-bottom: 15px;
      }

      .btn-group.duration-buttons {
        margin-bottom: 15px;
      }

      .btn-group.control-buttons {
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      }

      button {
        padding: 12px 16px;
        border: none;
        border-radius: var(--border-radius-small);
        cursor: pointer;
        font-weight: 600;
        font-size: 0.9rem;
        transition: var(--transition);
        text-transform: uppercase;
        letter-spacing: 0.3px;
      }

      .rent-btn {
        background: var(--success-gradient);
        color: var(--text-white);
        box-shadow: var(--box-shadow-soft);
      }

      .rent-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--box-shadow-hover);
      }

      .copy-btn {
        background: var(--primary-gradient);
        color: var(--text-white);
        box-shadow: var(--box-shadow-soft);
      }

      .copy-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--box-shadow-hover);
      }

      .reset-btn {
        background: var(--danger-gradient);
        color: var(--text-white);
        box-shadow: var(--box-shadow-soft);
      }

      .reset-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--box-shadow-hover);
      }

      .update-btn {
        background: var(--warning-gradient);
        color: var(--text-white);
        box-shadow: var(--box-shadow-soft);
      }

      .update-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--box-shadow-hover);
      }

      .manual-btn {
        background: var(--purple-gradient);
        color: var(--text-white);
        box-shadow: var(--box-shadow-soft);
      }

      .manual-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--box-shadow-hover);
      }

      .ready-btn {
        background: var(--warning-gradient);
        color: var(--text-white);
        width: 100%;
        padding: 15px;
        font-size: 1.1rem;
        font-weight: 600;
        border: none;
        border-radius: var(--border-radius-small);
        cursor: pointer;
        transition: var(--transition);
        box-shadow: var(--box-shadow-soft);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .ready-btn:hover {
        transform: translateY(-3px);
        box-shadow: var(--box-shadow-hover);
      }

      /* Modern modal styling */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(10px);
      }

      .modal-content {
        background: var(--glass-bg);
        backdrop-filter: var(--backdrop-filter);
        -webkit-backdrop-filter: var(--backdrop-filter);
        border: 1px solid var(--glass-border);
        margin: 5% auto;
        padding: 40px;
        border-radius: var(--border-radius);
        width: 400px;
        box-shadow: var(--glass-shadow);
        animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        color: var(--text-white);
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: translateY(-30px) scale(0.9);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .modal h3 {
        margin-bottom: 25px;
        font-weight: 700;
        color: var(--text-white);
        padding-bottom: 15px;
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        font-size: 1.3rem;
      }

      .close {
        color: rgba(255, 255, 255, 0.7);
        float: right;
        font-size: 32px;
        font-weight: bold;
        line-height: 0.8;
        cursor: pointer;
        transition: var(--transition);
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
      }

      .close:hover {
        color: var(--text-white);
        background: rgba(255, 255, 255, 0.1);
        transform: scale(1.1);
      }

      /* Modern notification */
      .notification {
        position: fixed;
        top: 30px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--glass-bg);
        backdrop-filter: var(--backdrop-filter);
        -webkit-backdrop-filter: var(--backdrop-filter);
        border: 1px solid var(--glass-border);
        color: var(--text-white);
        padding: 20px 30px;
        border-radius: var(--border-radius-small);
        box-shadow: var(--glass-shadow);
        z-index: 2000;
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
        transition: var(--transition);
        font-weight: 600;
      }

      .notification.show {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }

      /* Filter container modern styling */
      .filter-container {
        display: flex;
        align-items: center;
        margin-bottom: 25px;
        flex-wrap: wrap;
        gap: 15px;
        background: rgba(255, 255, 255, 0.05);
        padding: 20px;
        border-radius: var(--border-radius-small);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .filter-container label {
        margin-right: 10px;
        margin-bottom: 0;
        color: var(--text-white);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* Modern quick rent buttons */
      .summary-row {
        display: flex;
        width: 100%;
        justify-content: space-between;
        margin-top: 20px;
      }

      .summary-left {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        width: 100%;
      }

      .quick-rent-btn,
      .quick-rent-btn-9,
      .quick-rent-btn-12,
      .quick-rent-btn-24 {
        color: var(--text-white);
        border: none;
        padding: 20px 25px;
        border-radius: var(--border-radius-small);
        font-weight: 700;
        font-size: 1.2rem;
        cursor: pointer;
        transition: var(--transition);
        box-shadow: var(--box-shadow-soft);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        position: relative;
        overflow: hidden;
      }

      .quick-rent-btn {
        background: var(--success-gradient);
      }

      .quick-rent-btn-9 {
        background: linear-gradient(135deg, #20c997 0%, #17a2b8 100%);
      }

      .quick-rent-btn-12 {
        background: var(--warning-gradient);
      }

      .quick-rent-btn-24 {
        background: var(--purple-gradient);
      }

      .quick-rent-btn:hover,
      .quick-rent-btn-9:hover,
      .quick-rent-btn-12:hover,
      .quick-rent-btn-24:hover {
        transform: translateY(-3px) scale(1.02);
        box-shadow: var(--box-shadow-hover);
      }

      /* Scroll to top button */
      .scroll-to-top {
        position: fixed;
        bottom: 40px;
        right: 40px;
        background: var(--primary-gradient);
        color: var(--text-white);
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: none;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        box-shadow: var(--box-shadow-soft);
        transition: var(--transition);
        z-index: 1000;
        font-size: 24px;
        font-weight: bold;
      }

      .scroll-to-top:hover {
        transform: translateY(-5px) scale(1.1);
        box-shadow: var(--box-shadow-hover);
      }

      .scroll-to-top.show {
        display: flex;
      }

      /* Login container modern styling */
      .login-container {
        max-width: 450px;
        margin: 100px auto;
        padding: 40px;
        background: var(--glass-bg);
        backdrop-filter: var(--backdrop-filter);
        -webkit-backdrop-filter: var(--backdrop-filter);
        border: 1px solid var(--glass-border);
        border-radius: var(--border-radius);
        box-shadow: var(--glass-shadow);
        text-align: center;
        color: var(--text-white);
      }

      .login-container h2 {
        margin-bottom: 30px;
        color: var(--text-white);
        font-weight: 700;
        font-size: 2rem;
      }

      .login-container input {
        width: 100%;
        padding: 18px 20px;
        margin-bottom: 20px;
        border: 2px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--border-radius-small);
        font-family: inherit;
        font-size: 1rem;
        background: rgba(255, 255, 255, 0.1);
        color: var(--text-white);
        backdrop-filter: blur(10px);
      }

      .login-container input::placeholder {
        color: rgba(255, 255, 255, 0.6);
      }

      .login-container input:focus {
        outline: none;
        border-color: rgba(102, 126, 234, 0.8);
        box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        transform: translateY(-2px);
      }

      .login-btn {
        background: var(--primary-gradient);
        color: var(--text-white);
        padding: 18px 25px;
        border: none;
        border-radius: var(--border-radius-small);
        font-weight: 600;
        font-size: 1.1rem;
        cursor: pointer;
        width: 100%;
        transition: var(--transition);
        box-shadow: var(--box-shadow-soft);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .login-btn:hover {
        transform: translateY(-3px);
        box-shadow: var(--box-shadow-hover);
      }

      .logout-btn {
        background: rgba(255, 255, 255, 0.1);
        color: var(--text-white);
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 12px 20px;
        border-radius: var(--border-radius-small);
        font-size: 0.9rem;
        cursor: pointer;
        transition: var(--transition);
        backdrop-filter: blur(10px);
        font-weight: 600;
      }

      .logout-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
      }

      @keyframes loadingSpin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* Loading screen */
      #loadingScreen {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      #loadingScreen div {
        text-align: center;
      }

      #loadingScreen div div {
        border: 4px solid rgba(255, 255, 255, 0.2);
        border-top: 4px solid var(--text-white);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        margin: 0 auto 25px;
        animation: loadingSpin 1s linear infinite;
      }

      #loadingScreen p {
        font-family: inherit;
        color: var(--text-white);
        font-weight: 600;
        font-size: 1.2rem;
      }

      /* Error message */
      .error-message {
        color: #ff6b6b;
        margin-bottom: 20px;
        font-size: 0.95rem;
        font-weight: 500;
      }

      /* Disabled button state */
      .btn-disabled {
        background: rgba(255, 255, 255, 0.1) !important;
        cursor: not-allowed !important;
        opacity: 0.5;
        transform: none !important;
      }

      /* Password cards modern styling */
      .password-card {
        display: flex;
        align-items: center;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: var(--border-radius-small);
        padding: 10px 15px;
        margin: 6px 0;
        font-size: 0.95em;
        cursor: move;
        user-select: none;
        transition: var(--transition);
        position: relative;
        z-index: 1;
        color: var(--text-white);
      }

      .password-card:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-2px);
        box-shadow: var(--box-shadow-soft);
      }

      .password-card.active {
        background: rgba(102, 126, 234, 0.3);
        border-color: rgba(102, 126, 234, 0.6);
        box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        transform: translateY(-2px);
      }

      #passwordListContainer {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 10px;
        min-height: 60px;
        padding: 15px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: var(--border-radius-small);
        border: 2px dashed rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
      }

      /* Custom select modern styling */
      .custom-select-wrapper {
        position: relative;
        flex-grow: 0;
        max-width: none;
        min-width: auto;
        width: auto;
      }

      .custom-select {
        position: relative;
        flex: 1;
      }

      .select-trigger {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: var(--border-radius-small);
        padding: 12px 35px 12px 15px;
        font-family: inherit;
        font-size: 0.9rem;
        cursor: pointer;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: space-between;
        white-space: nowrap;
        min-width: 150px;
        width: auto;
        max-width: 400px;
        color: var(--text-white);
        transition: var(--transition);
      }

      .select-trigger:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.3);
      }

      .select-trigger.active {
        border-color: rgba(102, 126, 234, 0.8);
        box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
      }

      .arrow {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.7);
        transition: transform 0.3s;
      }

      .select-trigger.active .arrow {
        transform: rotate(180deg);
      }

      .custom-options {
        position: absolute;
        top: 100%;
        left: 0;
        background: var(--glass-bg);
        backdrop-filter: var(--backdrop-filter);
        -webkit-backdrop-filter: var(--backdrop-filter);
        border: 1px solid var(--glass-border);
        border-top: none;
        border-radius: 0 0 var(--border-radius-small) var(--border-radius-small);
        z-index: 1000;
        display: none;
        box-shadow: var(--glass-shadow);
        min-width: 100%;
        width: auto;
        white-space: nowrap;
        padding: 8px;
        max-height: 300px;
        overflow-y: auto;
      }

      .custom-options.show {
        display: block;
      }

      .custom-option {
        padding: 12px 15px;
        cursor: pointer;
        font-family: inherit;
        font-size: 0.9rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        transition: var(--transition);
        white-space: nowrap;
        border-radius: 8px;
        margin: 2px 4px;
        color: var(--text-white);
      }

      .custom-option:last-child {
        border-bottom: none;
      }

      .custom-option:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateX(3px);
        box-shadow: var(--box-shadow-soft);
        border-radius: 8px;
      }

      .custom-option.selected {
        background: var(--primary-gradient);
        color: var(--text-white);
        box-shadow: var(--box-shadow-soft);
      }

      /* Search container modern styling */
      .search-container {
        position: relative;
        flex-grow: 1;
        max-width: 300px;
      }

      .search-input {
        width: 100%;
        padding: 12px 35px 12px 15px;
        border-radius: var(--border-radius-small);
        border: 1px solid rgba(255, 255, 255, 0.2);
        font-family: inherit;
        font-size: 0.9rem;
        background: rgba(255, 255, 255, 0.1);
        color: var(--text-white);
        backdrop-filter: blur(10px);
        transition: var(--transition);
      }

      .search-input::placeholder {
        color: rgba(255, 255, 255, 0.6);
      }

      .search-input:focus {
        outline: none;
        border-color: rgba(102, 126, 234, 0.8);
        box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        transform: translateY(-2px);
      }

      .clear-search-btn {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: rgba(255, 255, 255, 0.6);
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        display: none;
        padding: 8px 10px;
        line-height: 1;
        border-radius: 50%;
        min-width: 36px;
        min-height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
      }

      .clear-search-btn:hover {
        color: #ff6b6b;
        background-color: rgba(255, 107, 107, 0.1);
        transform: translateY(-50%) scale(1.1);
      }

      /* Next email button modern styling */
      .next-email-btn {
        background: var(--primary-gradient);
        color: var(--text-white);
        border: none;
        border-radius: var(--border-radius-small);
        padding: 12px 15px;
        font-size: 0.9rem;
        cursor: pointer;
        transition: var(--transition);
        height: 40px;
        min-width: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        box-shadow: var(--box-shadow-soft);
      }

      .next-email-btn:hover {
        transform: translateY(-2px) scale(1.05);
        box-shadow: var(--box-shadow-hover);
      }

      .next-email-btn:disabled {
        background: rgba(255, 255, 255, 0.1);
        cursor: not-allowed;
        opacity: 0.6;
      }

      /* Sort expiration button modern styling */
      .sort-expiration-btn {
        background: var(--purple-gradient);
        color: var(--text-white);
        border: none;
        border-radius: var(--border-radius-small);
        padding: 10px 15px;
        font-size: 0.85rem;
        cursor: pointer;
        transition: var(--transition);
        margin-right: 15px;
        font-weight: 600;
        box-shadow: var(--box-shadow-soft);
      }

      .sort-expiration-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--box-shadow-hover);
      }

      .sort-expiration-btn.active {
        background: linear-gradient(135deg, #7048e8 0%, #9775fa 100%);
        box-shadow: 0 0 20px rgba(151, 117, 250, 0.4);
      }

      /* Account stats modern styling */
      .account-stats {
        margin-left: auto;
        white-space: nowrap;
        font-size: 0.9rem;
        color: var(--text-white);
        font-weight: 600;
      }

      /* Modern bulk textarea */
      .bulk-textarea {
        width: 100%;
        height: 300px;
        padding: 15px;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        border: 2px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--border-radius-small);
        resize: vertical;
        margin-bottom: 20px;
        background: rgba(255, 255, 255, 0.1);
        color: var(--text-white);
        backdrop-filter: blur(10px);
        transition: var(--transition);
      }

      .bulk-textarea::placeholder {
        color: rgba(255, 255, 255, 0.6);
      }

      .bulk-textarea:focus {
        outline: none;
        border-color: rgba(102, 126, 234, 0.8);
        box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
      }

      .modal-content.bulk-add {
        width: 550px;
        max-width: 90%;
      }

      /* Modern modal inputs */
      .modal input[type="date"],
      .modal input[type="time"],
      .modal input[type="number"] {
        width: 100%;
        padding: 15px 18px;
        border: 2px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--border-radius-small);
        font-family: inherit;
        margin-bottom: 20px;
        font-size: 0.95rem;
        background: rgba(255, 255, 255, 0.1);
        color: var(--text-white);
        backdrop-filter: blur(10px);
        transition: var(--transition);
      }

      .modal input[type="date"]:focus,
      .modal input[type="time"]:focus,
      .modal input[type="number"]:focus {
        outline: none;
        border-color: rgba(102, 126, 234, 0.8);
        box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        transform: translateY(-2px);
      }

      .modal button {
        width: 100%;
        padding: 15px;
        margin-top: 15px;
        font-size: 1rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* Email counter styling */
      .email-counter-available {
        color: #4facfe;
        font-weight: 700;
      }

      .email-counter-total {
        color: rgba(255, 255, 255, 0.7);
        font-weight: 500;
      }

      /* Last reset label modern styling */
      #lastResetLabel {
        position: fixed;
        top: 65px;
        left: 20px;
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.8);
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        padding: 8px 15px;
        border-radius: 15px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        font-weight: 500;
      }

      /* Responsive design */
      @media (max-width: 768px) {
        body {
          padding: 10px;
        }

        .container {
          padding: 10px;
        }

        h1 {
          font-size: 2.2rem;
        }

        .accounts-container {
          grid-template-columns: 1fr;
        }

        .buttons-container {
          grid-template-columns: 1fr;
        }

        .summary-left {
          grid-template-columns: repeat(2, 1fr);
          gap: 10px;
        }

        .modal-content {
          width: 90%;
          margin: 10% auto;
          padding: 25px;
        }

        .version-badge {
          top: 10px;
          left: 10px;
          padding: 8px 15px;
        }
      }

      /* Additional animations */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .account-card {
        animation: fadeInUp 0.6s ease-out forwards;
      }

      .account-card:nth-child(1) { animation-delay: 0.1s; }
      .account-card:nth-child(2) { animation-delay: 0.2s; }
      .account-card:nth-child(3) { animation-delay: 0.3s; }
      .account-card:nth-child(4) { animation-delay: 0.4s; }
      .account-card:nth-child(5) { animation-delay: 0.5s; }
      .account-card:nth-child(6) { animation-delay: 0.6s; }
    </style>
  </head>
  <body>
    <!-- Tambahkan badge versi dengan link ke GitHub -->
    <a href="https://github.com/Gacode123/UnlockTool" target="_blank" style="text-decoration: none; display: inline-block">
              <div class="version-badge">v3.1</div>
    </a>
    <div id="lastResetLabel">Last All Reset at: <span id="lastResetTime">--:--</span></div>

    <!-- Loading Screen -->
    <div id="loadingScreen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; z-index: 9999">
      <div>
        <div></div>
        <p>Loading...</p>
      </div>
    </div>

    <!-- Login Container - sembunyikan secara default -->
    <div id="loginContainer" class="login-container" style="display: none">
      <h2>Login Unlock Tool</h2>
      <div id="errorMessage" class="error-message"></div>
      <input type="email" id="email" placeholder="Email" required />
      <input type="password" id="password" placeholder="Password" required />
      <div style="display: flex; align-items: center; margin-bottom: 15px; justify-content: center">
        <input type="checkbox" id="rememberMe" checked style="width: auto; margin-right: 8px; cursor: pointer" />
        <label for="rememberMe" style="margin-bottom: 0; cursor: pointer">Ingat Saya</label>
      </div>
      <button id="loginBtn" class="login-btn">Login</button>
    </div>

    <!-- Main App Container - sembunyikan secara default -->
    <div id="appContainer" style="display: none">
              <div class="container">
          <h1>ðŸ”“ Unlock Tool Manager</h1>
          <div class="buttons-container">
            <button id="addAccountBtn" class="action-btn add-btn">âž• Tambah Akun Baru</button>
            <button id="bulkAddBtn" class="action-btn add-btn">ðŸ“¥ Bulk Add Account</button>
            <button id="bulkChangePwdBtn" class="action-btn purple-btn">ðŸ”‘ Bulk Change Password</button>
            <button class="action-btn ads-btn">ðŸŽ¯ Setting Iklan</button>
            <button id="exportBtn" class="action-btn export-btn">ðŸ“¤ Ekspor Data</button>
            <div class="action-btn import-btn">
              ðŸ“¥ Impor Data
              <input type="file" id="importFile" accept=".json" />
            </div>
            <button id="resetAllBtn" class="action-btn danger-btn">ðŸ”„ Reset All Available</button>
            <button id="logoutBtn" class="logout-btn">ðŸšª Logout</button>
          </div>
        <div class="account-summary">
          <div class="filter-container">
            <label for="emailFilter"><strong>Filter Email:</strong></label>
            <button id="nextEmailBtn" class="next-email-btn" title="Pindah ke email berikutnya">â–¶</button>
            <div class="custom-select-wrapper">
              <div id="emailFilter" class="custom-select">
                <div class="select-trigger">
                  <span>Semua Email</span>
                  <div class="arrow">â–¼</div>
                </div>
                <div class="custom-options">
                  <div class="custom-option active" data-value="">Semua Email</div>
                  <!-- Opsi email akan diisi secara dinamis -->
                </div>
              </div>
            </div>

            <label for="usernameSearch" class="search-label"><strong>Cari Username:</strong></label>
            <div class="search-container">
              <input type="text" id="usernameSearch" class="search-input" placeholder="Ketik untuk mencari..." />
              <button type="button" id="clearSearch" class="clear-search-btn">&times;</button>
            </div>

            <div class="account-stats">
              <button id="sortByExpirationBtn" class="sort-expiration-btn" title="Sort berdasarkan expiration date">ðŸ“… Sort Expiration</button>
              <strong>Total:</strong> <span id="totalAccounts">0</span> | <strong>Ready:</strong> <span id="availableAccounts">0</span>
            </div>

            <div id="passwordListContainer"></div>
          </div>

          <div class="summary-row">
            <div class="summary-left">
              <button id="quickRentBtn" class="quick-rent-btn">âš¡ 6 Jam</button>
              <button id="quickRent9Btn" class="quick-rent-btn-9">âš¡ 9 Jam</button>
              <button id="quickRent12Btn" class="quick-rent-btn-12">âš¡ 12 Jam</button>
              <button id="quickRent24Btn" class="quick-rent-btn-24">âš¡ 24 Jam</button>
            </div>
          </div>
        </div>
        <div class="accounts-container" id="accountsContainer">
          <!-- Akun akan dibuat secara dinamis dengan JavaScript -->
        </div>
      </div>
    </div>

    <!-- Tombol Scroll to Top -->
    <div class="scroll-to-top" id="scrollToTop">â†‘</div>

    <!-- Modal Dialog untuk Input Manual -->
    <div id="manualModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h3>Input Manual Waktu Berakhir</h3>

        <div class="form-group">
          <div style="margin-bottom: 10px">
            <label style="display: inline-flex; align-items: center; margin-right: 20px">
              <input type="radio" name="timeInputType" value="exact" onchange="toggleTimeInputType()" />
              <span style="margin-left: 5px">Waktu Exact</span>
            </label>
            <label style="display: inline-flex; align-items: center">
              <input type="radio" name="timeInputType" value="duration" checked onchange="toggleTimeInputType()" />
              <span style="margin-left: 5px">Durasi</span>
            </label>
          </div>
        </div>

        <!-- Input Waktu Exact -->
        <div id="exactTimeInputs" style="display: none">
          <div class="form-group">
            <label for="manualDate">Tanggal:</label>
            <input type="date" id="manualDate" required />
          </div>
          <div class="form-group">
            <label for="manualTime">Jam:</label>
            <input type="time" id="manualTime" required />
          </div>
        </div>

        <!-- Input Durasi -->
        <div id="durationInputs">
          <div class="form-group">
            <label for="durationHours">Jam:</label>
            <input type="number" id="durationHours" min="0" max="72" value="0" required />
          </div>
          <div class="form-group">
            <label for="durationMinutes">Menit:</label>
            <input type="number" id="durationMinutes" min="0" max="59" value="0" required />
          </div>
        </div>

        <button id="saveManualBtn" class="rent-btn">Simpan</button>
      </div>
    </div>

    <!-- Modal Dialog untuk Bulk Add Account -->
    <div id="bulkAddModal" class="modal">
      <div class="modal-content bulk-add">
        <span class="close" id="closeBulkModal">&times;</span>
        <h3>Bulk Add Account</h3>

        <div class="form-group">
          <label for="bulkInput">Format: Username diikuti Email (2 format didukung)</label>
          <textarea
            id="bulkInput"
            class="bulk-textarea"
            placeholder="Format 1 (dengan baris kosong):&#10;username1&#10;email1@domain.com&#10;&#10;username2&#10;email2@domain.com&#10;&#10;Format 2 (tanpa baris kosong):&#10;username1&#10;email1@domain.com&#10;username2&#10;email2@domain.com"
          ></textarea>
        </div>

        <p style="margin-bottom: 15px; font-size: 0.9rem; color: rgba(255, 255, 255, 0.8); font-weight: 500;">Password default: wawawa666</p>

        <button id="processBulkBtn" class="add-btn" style="width: 100%">Tambahkan Akun</button>
      </div>
    </div>

    <!-- Modal Dialog untuk Bulk Change Password -->
    <div id="bulkChangePwdModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeBulkChangePwdModal()">&times;</span>
        <h3>Bulk Change Password</h3>
        <div class="form-group">
          <label for="newPassword">New Password:</label>
          <input type="password" id="newPassword" />
        </div>
        <button class="rent-btn" onclick="applyBulkChangePwd()">Ganti Semua</button>
      </div>
    </div>

    <!-- Notifikasi -->
    <div id="notification" class="notification"></div>

    <script>
      // Tambahkan variabel untuk melacak status autentikasi
      let authCheckComplete = false;

      // Event listener untuk global error handling
      window.addEventListener("error", function (event) {
        console.error("Global error:", event.error);
        // Jika terjadi error, sembunyikan loading screen
        document.getElementById("loadingScreen").style.display = "none";
      });

      // Handler untuk cek status auth dan loading screen
      document.addEventListener("DOMContentLoaded", function () {
        logDebug("DOM telah dimuat, memeriksa status login...");

        // Tampilkan loading screen terlebih dahulu
        document.getElementById("loadingScreen").style.display = "flex";
        document.getElementById("loginContainer").style.display = "none";
        document.getElementById("appContainer").style.display = "none";

        // Kurangi waktu loading menjadi 300ms
        setTimeout(function () {
          logDebug("Menjalankan pengecekan autentikasi...");
          // Cek status login dengan Firebase auth
          firebase.auth().onAuthStateChanged(function (user) {
            logDebug("Auth state changed, user:", user ? user.email : "tidak ada");
            // Tandai bahwa pengecekan autentikasi sudah selesai
            authCheckComplete = true;

            // Sembunyikan loading screen
            document.getElementById("loadingScreen").style.display = "none";

            if (user) {
              // User sudah login
              document.getElementById("appContainer").style.display = "block";
              // Inisialisasi app
              initializeApp();

              // Tambahkan event listener untuk refresh
              window.addEventListener("beforeunload", function () {
                // Simpan status sorting terakhir
                localStorage.setItem("lastSortTime", new Date().getTime());
              });

              // Cek apakah perlu perbaikan sorting
              const lastSortTime = localStorage.getItem("lastSortTime");
              if (lastSortTime) {
                const timeSinceLastSort = new Date().getTime() - parseInt(lastSortTime);
                // Jika lebih dari 1 menit sejak sort terakhir, lakukan perbaikan
                if (timeSinceLastSort > 60000) {
                  logDebug("Melakukan perbaikan sorting setelah refresh...");
                  // Tunggu sebentar untuk memastikan data sudah dimuat
                  setTimeout(() => {
                    if (accountManager) {
                      accountManager.renderAccounts(true);
                    }
                  }, 1000);
                }
              }
            } else {
              // User belum login
              document.getElementById("loginContainer").style.display = "block";
            }
          });
        }, 300); // Kurangi delay loading menjadi 300ms


      });

      // Event listener untuk tombol login
      document.getElementById("loginBtn").addEventListener("click", () => {
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const rememberMe = document.getElementById("rememberMe").checked;
        const errorMessage = document.getElementById("errorMessage");

        if (!email || !password) {
          errorMessage.textContent = "Mohon isi email dan password";
          return;
        }

        // Tampilkan loading screen saat login
        document.getElementById("loadingScreen").style.display = "flex";
        document.getElementById("loginContainer").style.display = "none";

        // Set persistence berdasarkan pilihan "Remember Me"
        const persistenceType = rememberMe ? firebase.auth.Auth.Persistence.LOCAL : firebase.auth.Auth.Persistence.SESSION;

        firebase
          .auth()
          .setPersistence(persistenceType)
          .then(() => {
            return firebase.auth().signInWithEmailAndPassword(email, password);
          })
          .then((userCredential) => {
            // Login berhasil
            errorMessage.textContent = "";
          })
          .catch((error) => {
            // Ada error saat login
            console.error("Error:", error);

            // Sembunyikan loading screen dan tampilkan login lagi
            document.getElementById("loadingScreen").style.display = "none";
            document.getElementById("loginContainer").style.display = "block";

            if (error.code === "auth/wrong-password" || error.code === "auth/user-not-found") {
              errorMessage.textContent = "Email atau password salah";
            } else {
              errorMessage.textContent = "Error: " + error.message;
            }
          });
      });

      // Tombol Enter untuk login
      document.getElementById("password").addEventListener("keyup", (event) => {
        if (event.key === "Enter") {
          document.getElementById("loginBtn").click();
        }
      });

      // Fungsi inisialisasi app - memisahkan logik inisialisasi
      function initializeApp() {
        logDebug("Inisialisasi app...");
        try {
          // Inisialisasi manager akun
          accountManager = new AccountManager();
          logDebug("AccountManager berhasil diinisialisasi");

          // Set interval untuk memperbarui tampilan, tapi interval lebih panjang (30 detik)
          // untuk mengurangi beban pada Firebase
          setInterval(() => {
            accountManager.renderAccounts(true);
          }, 30000);

          // Logout handler - pindah ke sini agar tersedia hanya setelah login
          document.getElementById("logoutBtn").addEventListener("click", () => {
            // Tampilkan loading screen saat logout
            document.getElementById("loadingScreen").style.display = "flex";
            document.getElementById("appContainer").style.display = "none";

            firebase
              .auth()
              .signOut()
              .then(() => {
                // Logout berhasil
                // Sembunyikan loading dan tampilkan login
                document.getElementById("loadingScreen").style.display = "none";
                document.getElementById("loginContainer").style.display = "block";
              })
              .catch((error) => {
                console.error("Error saat logout:", error);
                // Jika error, tetap coba tampilkan login
                document.getElementById("loadingScreen").style.display = "none";
                document.getElementById("loginContainer").style.display = "block";
              });
          });

          // Sisipkan semua event listener lain di sini
          // Event listener untuk tombol quick renting
          const quickRentBtn = document.getElementById("quickRentBtn");
          if (quickRentBtn) {
            quickRentBtn.addEventListener("click", () => {
              logDebug("Quick Rent 6 Jam diklik");
              accountManager.quickRent(6);
            });
          }

          const quickRent9Btn = document.getElementById("quickRent9Btn");
          if (quickRent9Btn) {
            quickRent9Btn.addEventListener("click", () => {
              logDebug("Quick Rent 9 Jam diklik");
              accountManager.quickRent(9);
            });
          }

          const quickRent12Btn = document.getElementById("quickRent12Btn");
          if (quickRent12Btn) {
            quickRent12Btn.addEventListener("click", () => {
              logDebug("Quick Rent 12 Jam diklik");
              accountManager.quickRent(12);
            });
          }

          const quickRent24Btn = document.getElementById("quickRent24Btn");
          if (quickRent24Btn) {
            quickRent24Btn.addEventListener("click", () => {
              logDebug("Quick Rent 24 Jam diklik");
              accountManager.quickRent(24);
            });
          }

          // Tambahan optional chaining (?.) untuk mencegah error jika tombol tidak ditemukan
          document.getElementById("addAccountBtn")?.addEventListener("click", () => {
            accountManager.addAccount();
          });

          document.getElementById("bulkAddBtn")?.addEventListener("click", openBulkModal);
          document.getElementById("bulkChangePwdBtn")?.addEventListener("click", openBulkChangePwdModal);

          document.querySelector(".ads-btn")?.addEventListener("click", () => {
            window.open("https://seller.shopee.co.id/portal/marketing/pas/product/manual/315686975?from=1742317200&to=1742403599&group=today", "_blank");
          });

          document.getElementById("exportBtn")?.addEventListener("click", () => {
            accountManager.exportData();
          });

          document.getElementById("importFile")?.addEventListener("change", (event) => {
            if (event.target.files.length > 0) {
              const file = event.target.files[0];
              if (file.type === "application/json" || file.name.endsWith(".json")) {
                accountManager.importData(file);
              } else {
                accountManager.showNotification("Format file tidak valid. Harap pilih file JSON.");
              }
              // Reset input file untuk memungkinkan impor file yang sama berulang kali
              event.target.value = "";
            }
          });

          // Event listeners untuk modal input manual
          document.querySelector(".close")?.addEventListener("click", closeManualModal);
          document.getElementById("saveManualBtn")?.addEventListener("click", saveManualTime);

          // Event listener untuk proses data bulk add
          const processBulkBtn = document.getElementById("processBulkBtn");
          if (processBulkBtn) {
            processBulkBtn.addEventListener("click", function (event) {
              event.preventDefault();
              console.log("Tombol processBulkBtn diklik");
              try {
                processBulkAccounts();
              } catch (error) {
                console.error("Error dalam processBulkAccounts:", error);
                alert("Terjadi error: " + error.message);
              }
            });
            console.log("Event listener processBulkBtn berhasil dipasang");
          } else {
            console.error("Element processBulkBtn tidak ditemukan!");
          }

          // Event listener untuk menutup modal bulk add
          document.getElementById("closeBulkModal")?.addEventListener("click", closeBulkModal);

          // Event listener untuk filter email
          document.getElementById("emailFilter")?.addEventListener("change", (event) => {
            accountManager.setEmailFilter(event.target.value);
          });

          // Event listeners untuk custom email dropdown
          const emailFilter = document.getElementById("emailFilter");
          if (emailFilter) {
            const selectTrigger = emailFilter.querySelector(".select-trigger");
            const customOptions = emailFilter.querySelector(".custom-options");

            // Toggle dropdown
            selectTrigger.addEventListener("click", () => {
              selectTrigger.classList.toggle("active");
              customOptions.classList.toggle("show");
            });

            // Handle option click
            emailFilter.addEventListener("click", (event) => {
              if (event.target.classList.contains("custom-option")) {
                const value = event.target.getAttribute("data-value");
                accountManager.setEmailFilter(value);
                selectTrigger.classList.remove("active");
                customOptions.classList.remove("show");
              }
            });

            // Close dropdown when clicking outside
            document.addEventListener("click", (event) => {
              if (!emailFilter.contains(event.target)) {
                selectTrigger.classList.remove("active");
                customOptions.classList.remove("show");
              }
            });
          }



          // Event listener untuk filter pencarian username
          document.getElementById("usernameSearch")?.addEventListener("input", (event) => {
            accountManager.setSearchQuery(event.target.value);

            // Tampilkan tombol clear jika ada teks, sembunyikan jika kosong
            const clearButton = document.getElementById("clearSearch");
            if (clearButton) {
              if (event.target.value) {
                clearButton.style.display = "block";
              } else {
                clearButton.style.display = "none";
              }
            }
          });

          // Event listener untuk tombol clear search
          document.getElementById("clearSearch")?.addEventListener("click", () => {
            const searchInput = document.getElementById("usernameSearch");
            if (searchInput) {
              searchInput.value = "";
              accountManager.setSearchQuery("");
              document.getElementById("clearSearch").style.display = "none";
              searchInput.focus(); // Fokus kembali ke input pencarian
            }
          });

          // Event listener untuk tombol scroll to top
          const scrollToTopBtn = document.getElementById("scrollToTop");

          if (scrollToTopBtn) {
            window.addEventListener("scroll", () => {
              if (window.pageYOffset > 300) {
                // Tampilkan tombol setelah scroll 300px
                scrollToTopBtn.classList.add("show");
              } else {
                scrollToTopBtn.classList.remove("show");
              }
            });

            scrollToTopBtn.addEventListener("click", () => {
              window.scrollTo({
                top: 0,
                behavior: "smooth",
              });
            });
          }

          // Menutup modal jika user mengklik di luar modal
          window.addEventListener("click", (event) => {
            const manualModal = document.getElementById("manualModal");
            const bulkAddModal = document.getElementById("bulkAddModal");

            if (event.target == manualModal) {
              closeManualModal();
            }

            if (event.target == bulkAddModal) {
              closeBulkModal();
            }
          });

          // Event listener untuk tombol Reset All Available
          document.getElementById("resetAllBtn").addEventListener("click", () => accountManager.resetAllAvailable());

          // Event listener untuk tombol next email
          document.getElementById("nextEmailBtn")?.addEventListener("click", () => {
            accountManager.moveToNextEmail();
          });

          // Event listener untuk tombol sort expiration
          document.getElementById("sortByExpirationBtn")?.addEventListener("click", () => {
            accountManager.toggleSortByExpiration();
          });

          // Set label waktu reset awal
          document.getElementById("lastResetTime").textContent = "--:--";
          // Inisialisasi countdown reset berikutnya
          // HAPUS: scheduleNextReset();
          // HAPUS: setInterval(updateCountdown, 1000);
        } catch (err) {
          console.error("Error saat inisialisasi app: ", err);
        }
      }

      // Fungsi untuk menghitung dan memformat waktu tersisa
      function getRemainingTime(availableAt) {
        if (!availableAt) return null;

        const now = new Date();
        const availableDate = new Date(availableAt);
        const diffMs = availableDate - now;

        if (diffMs <= 0) return "Available";

        const diffMinutes = Math.floor(diffMs / (1000 * 60));
        const diffHours = Math.floor(diffMinutes / 60);
        const remainingMinutes = diffMinutes % 60;

        if (diffHours > 0) {
          return `${diffHours} jam ${remainingMinutes} menit lagi`;
        } else {
          return `${remainingMinutes} menit lagi`;
        }
      }

      // Fungsi untuk format tanggal dan waktu lebih mudah dibaca
      function formatDateTime(date) {
        if (!date) return "Available";

        const options = {
          day: "2-digit",
          month: "2-digit",
          year: "numeric",
          hour: "2-digit",
          minute: "2-digit",
          hour12: false,
        };
        return new Date(date).toLocaleString("id-ID", options);
      }

      // Fungsi untuk menyalin teks ke clipboard
      function copyToClipboard(text, buttonElement) {
        const textarea = document.createElement("textarea");
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand("copy");
        document.body.removeChild(textarea);

        // Memberikan efek visual saat tombol diklik
        const originalText = buttonElement.textContent;
        buttonElement.textContent = "Tersalin!";

        // Cek kelas tombol untuk menentukan warna efek
        if (buttonElement.classList.contains("primary-copy-btn")) {
          buttonElement.style.backgroundColor = "#099268";

          setTimeout(() => {
            buttonElement.textContent = originalText;
            buttonElement.style.backgroundColor = "#5469d4";
          }, 1000);
        } else {
          buttonElement.style.backgroundColor = "#099268";

          setTimeout(() => {
            buttonElement.textContent = originalText;
            buttonElement.style.backgroundColor = "#5469d4";
          }, 1000);
        }
      }

      // Fungsi untuk copy field individual dengan efek visual
      function copyField(text, buttonElement) {
        const textarea = document.createElement("textarea");
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand("copy");
        document.body.removeChild(textarea);

        // Efek visual untuk tombol kecil
        const originalText = buttonElement.textContent;
        const originalBg = buttonElement.style.backgroundColor;

        buttonElement.textContent = "âœ“";
        buttonElement.style.backgroundColor = "#099268";

        setTimeout(() => {
          buttonElement.textContent = originalText;
          buttonElement.style.backgroundColor = originalBg;
        }, 800);
      }

      // Fungsi untuk copy field dari data attribute
      function copyFieldFromData(buttonElement) {
        const text = buttonElement.getAttribute("data-copy-text");
        if (!text) return;

        const textarea = document.createElement("textarea");
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand("copy");
        document.body.removeChild(textarea);

        // Efek visual untuk tombol kecil
        const originalText = buttonElement.textContent;
        const originalColor = buttonElement.style.color;

        buttonElement.textContent = "âœ“";
        buttonElement.style.color = "#099268";

        setTimeout(() => {
          buttonElement.textContent = originalText;
          buttonElement.style.color = originalColor;
        }, 800);
      }

      // Kelas untuk mengelola setiap akun
      class AccountManager {
        constructor(accounts = []) {
          this.accounts = accounts.length ? accounts : this.createDefaultAccounts();
          this.lastRentedIndex = -1; // Menambahkan properti untuk melacak akun yang baru disewa
          this.selectedEmail = ""; // Menyimpan email yang dipilih untuk filter
          this.selectedPassword = ""; // Menyimpan password yang dipilih untuk filter
          this.searchQuery = ""; // Menyimpan kata kunci pencarian username
          this.resetTimers = {}; // Tambahkan property untuk menyimpan timer reset
          this.sortByExpiration = false; // Track apakah sedang sort by expiration


          // Tambahkan listener Firebase untuk real-time updates
          firebase
            .database()
            .ref("accounts")
            .on("value", (snapshot) => {
              const savedAccounts = snapshot.val();
              if (savedAccounts) {
                this.accounts = savedAccounts;
                this.renderAccounts();
                this.populateEmailFilter();
                this.populatePasswordFilter();
              }
            });

          this.loadAccounts();
        }

        createDefaultAccounts() {
          const defaultAccounts = [];
          for (let i = 1; i <= 6; i++) {
            defaultAccounts.push({
              id: i,
              name: `Akun ${i}`,
              username: "",
              password: "wawawa666",
              email: "",
              availableAt: null,
              expirationDate: "", // Ganti note dengan expirationDate
              isReady: true, // Akun default sudah ready
            });
          }
          return defaultAccounts;
        }

        addAccount() {
          // Cari ID tertinggi yang valid, atau gunakan 1 jika tidak ada
          const validIds = this.accounts.map((account) => account.id).filter((id) => typeof id === "number" && !isNaN(id));
          const newId = validIds.length > 0 ? Math.max(...validIds) + 1 : 1;

          // Validasi bahwa newId adalah angka yang valid
          if (typeof newId !== "number" || isNaN(newId)) {
            console.error("Error: newId tidak valid:", newId);
            this.showNotification("Error: Tidak dapat menentukan ID untuk akun baru");
            return;
          }

          const newAccount = {
            id: newId,
            name: `Akun ${newId}`,
            username: `akun${newId}`,
            password: "wawawa666",
            email: "",
            availableAt: null,
            expirationDate: "", // Ganti note dengan expirationDate
            isReady: false, // Akun baru belum ready
          };

          // Tambahkan akun baru ke awal array
          this.accounts.unshift(newAccount);
          this.saveAccounts();
          this.populateEmailFilter();
          this.renderAccounts();

          // Scroll ke atas halaman
          window.scrollTo({
            top: 0,
            behavior: "smooth",
          });

          // Tampilkan notifikasi akun baru ditambahkan
          this.showNotification(`Akun baru (Akun ${newId}) telah ditambahkan`);
        }

        saveAccounts() {
          // Firebase: Simpan data ke Realtime Database
          firebase
            .database()
            .ref("accounts")
            .set(this.accounts)
            .then(() => {
              console.log("Data saved successfully to Firebase");
              this.syncWithDatabase();
            })
            .catch((error) => {
              console.error("Error saving data to Firebase:", error);
              // Fallback ke localStorage jika Firebase gagal
              localStorage.setItem("unlockToolAccounts", JSON.stringify(this.accounts));
            });
        }

        loadAccounts() {
          // Firebase: Ambil data dari Realtime Database
          firebase
            .database()
            .ref("accounts")
            .once("value")
            .then((snapshot) => {
              const savedAccounts = snapshot.val();
              if (savedAccounts) {
                this.accounts = savedAccounts;
              } else {
                // Jika tidak ada data di Firebase, coba ambil dari localStorage
                const localAccounts = localStorage.getItem("unlockToolAccounts");
                if (localAccounts) {
                  this.accounts = JSON.parse(localAccounts);
                  // Simpan data localStorage ke Firebase
                  this.saveAccounts();
                } else {
                  this.accounts = this.createDefaultAccounts();
                }
              }

              // Bersihkan dan perbaiki data akun
              this.cleanupAccountData();

              this.renderAccounts();
              this.populateEmailFilter();
              this.populatePasswordFilter();
            })
            .catch((error) => {
              console.error("Error loading data from Firebase:", error);
              // Fallback ke localStorage jika Firebase gagal
              const savedAccounts = localStorage.getItem("unlockToolAccounts");
              this.accounts = savedAccounts ? JSON.parse(savedAccounts) : this.createDefaultAccounts();

              // Bersihkan dan perbaiki data akun
              this.cleanupAccountData();

              this.renderAccounts();
              this.populateEmailFilter();
              this.populatePasswordFilter();
            });
        }

        // Fungsi untuk membersihkan dan memperbaiki data akun
        cleanupAccountData() {
          console.log("Membersihkan data akun...");

          // Filter akun yang valid dan perbaiki ID yang rusak
          this.accounts = this.accounts.filter((account) => account && typeof account === "object");

          // Perbaiki ID yang rusak atau hilang
          let nextId = 1;
          this.accounts.forEach((account, index) => {
            if (typeof account.id !== "number" || isNaN(account.id)) {
              console.log(`Memperbaiki ID akun index ${index}, ID lama:`, account.id);
              account.id = nextId;
            }
            nextId = Math.max(nextId, account.id) + 1;
          });

          // Pastikan tidak ada ID duplikat
          const usedIds = new Set();
          this.accounts.forEach((account) => {
            if (usedIds.has(account.id)) {
              console.log(`ID duplikat ditemukan: ${account.id}, mengubah ke ${nextId}`);
              account.id = nextId++;
            }
            usedIds.add(account.id);
          });

          console.log("Data akun berhasil dibersihkan");

          // Simpan data yang sudah dibersihkan jika ada perubahan
          if (this.accounts.some((account) => typeof account.id !== "number" || isNaN(account.id))) {
            console.log("Menyimpan data yang sudah diperbaiki...");
            this.saveAccounts();
          }
        }

        updateAccount(index, data) {
          this.accounts[index] = { ...this.accounts[index], ...data };
          this.saveAccounts();
          // Perbarui filter email jika ada perubahan pada properti email
          if ("email" in data) {
            this.populateEmailFilter();
          }
          // Perbarui filter password jika ada perubahan pada properti password
          if ("password" in data) {
            this.populatePasswordFilter();
          }
          this.renderAccounts();
        }

        rentAccount(index, hours) {
          const now = new Date();
          // Tambahkan 15 menit buffer hanya untuk sewa 6 jam
          let additionalBuffer = 0;
          if (hours === 6) {
            additionalBuffer = 15 * 60 * 1000; // 15 menit dalam milidetik
          }

          const availableAt = new Date(now.getTime() + hours * 60 * 60 * 1000 + additionalBuffer);
          this.updateAccount(index, {
            availableAt: availableAt.toISOString(),
            lastRentedHours: hours, // Tetap menyimpan durasi asli
            manuallyUpdated: false, // Bukan update manual
          });



          // Auto copy info
          this.copyInfoWithTime(index);

          // Tandai akun yang baru disewa
          this.lastRentedIndex = index;

          // Render ulang dengan sorting yang benar
          setTimeout(() => {
            this.renderAccounts(true);
            // Reset lastRentedIndex setelah render
            this.lastRentedIndex = -1;
          }, 100);
        }

        updateRentTime(index) {
          // Bersihkan timer reset jika ada
          if (this.resetTimers[index]) {
            clearTimeout(this.resetTimers[index]);
            delete this.resetTimers[index];
          }
          const account = this.accounts[index];
          if (!account.lastRentedHours) return; // Tidak ada info durasi sewa sebelumnya

          const now = new Date();
          const hours = account.lastRentedHours;
          // Tidak ada buffer 15 menit untuk update karena pembeli sudah dikonfirmasi login
          const availableAt = new Date(now.getTime() + hours * 60 * 60 * 1000);

          this.updateAccount(index, {
            availableAt: availableAt.toISOString(),
            manuallyUpdated: true, // Tandai bahwa akun diupdate secara manual
          });

          // Auto copy info
          this.copyInfoWithTime(index);

          // Reset pencarian username
          this.searchQuery = "";
          const searchInput = document.getElementById("usernameSearch");
          if (searchInput) {
            searchInput.value = "";
          }
          // Sembunyikan tombol clear search
          const clearButton = document.getElementById("clearSearch");
          if (clearButton) {
            clearButton.style.display = "none";
          }
          // Render ulang dengan reset pencarian
          this.renderAccounts();
        }

        setManualRentTime(index, dateTime) {
          // Bersihkan timer reset jika ada
          if (this.resetTimers[index]) {
            clearTimeout(this.resetTimers[index]);
            delete this.resetTimers[index];
          }
          // Tidak ada buffer 15 menit untuk input manual karena ini sudah dikonfirmasi login
          this.updateAccount(index, {
            availableAt: dateTime.toISOString(),
            lastRentedHours: Math.round((dateTime - new Date()) / (1000 * 60 * 60)), // Default 6 jam jika tanggal yang dimasukkan sudah lewat
            manuallyUpdated: true, // Tandai bahwa akun diupdate secara manual
          });

          // Auto copy info
          this.copyInfoWithTime(index);

          // Reset pencarian username
          this.searchQuery = "";
          const searchInput = document.getElementById("usernameSearch");
          if (searchInput) {
            searchInput.value = "";
          }
          // Sembunyikan tombol clear search
          const clearButton = document.getElementById("clearSearch");
          if (clearButton) {
            clearButton.style.display = "none";
          }
          // Render ulang dengan reset pencarian
          this.renderAccounts();
        }

        resetAccount(index) {
          // Simpan status manuallyUpdated sebelum reset
          const wasManual = this.accounts[index].manuallyUpdated;
          this.updateAccount(index, {
            availableAt: null,
            manuallyUpdated: wasManual, // JANGAN diubah ke false, tetap sesuai sebelumnya
          });
          this.clearSearchBox(); // â¬…ï¸ tambahkan
          this.renderAccounts();
        }

        markAccountAsReady(index) {
          this.updateAccount(index, {
            isReady: true,
            manuallyUpdated: true, // Tandai sebagai available 100% karena baru pertama kali
          });
          this.showNotification("Akun telah siap digunakan");
        }

        isAccountAvailable(account) {
          if (!account.isReady) return false; // Akun yang belum ready tidak bisa digunakan
          if (!account.availableAt) return true;

          const now = new Date();
          const availableAt = new Date(account.availableAt);
          return now >= availableAt;
        }

        clearSearchBox() {
          this.searchQuery = "";
          const searchInput = document.getElementById("usernameSearch");
          const clearButton = document.getElementById("clearSearch");
          if (searchInput) searchInput.value = "";
          if (clearButton) clearButton.style.display = "none";
        }

        renderAccounts(sort = true) {
          const container = document.getElementById("accountsContainer");
          if (!container) {
            console.error("ERROR: Element accountsContainer tidak ditemukan!");
            return;
          }
          container.innerHTML = "";

          logDebug("Merender akun, jumlah total: ", this.accounts.length);

          // Filter akun yang memiliki username dan password, lalu urutkan
          let filteredAccounts = [...this.accounts].filter((account) => account && account.username && account.username.trim() !== "" && account.password && account.password.trim() !== "");

          logDebug("Akun setelah filter username/password: ", filteredAccounts.length);

          // Tambahkan filter berdasarkan email jika ada email yang dipilih
          if (this.selectedEmail) {
            filteredAccounts = filteredAccounts.filter((account) => account.email === this.selectedEmail);
            logDebug("Akun setelah filter email: ", filteredAccounts.length);
          }

          // Tambahkan filter berdasarkan password jika ada password yang dipilih
          if (this.selectedPassword) {
            filteredAccounts = filteredAccounts.filter((account) => account.password === this.selectedPassword);
            logDebug("Akun setelah filter password: ", filteredAccounts.length);
          }

          // Tambahkan filter berdasarkan pencarian username jika ada
          if (this.searchQuery) {
            const query = this.searchQuery.toLowerCase();
            filteredAccounts = filteredAccounts.filter((account) => account.username.toLowerCase().includes(query));
            logDebug("Akun setelah filter pencarian: ", filteredAccounts.length);
          }

          // Hitung jumlah akun yang available dan not ready
          const availableAccounts = filteredAccounts.filter((account) => this.isAccountAvailable(account)).length;
          const notReadyAccounts = filteredAccounts.filter((account) => !account.isReady).length;

          // Update informasi ringkasan akun
          const totalAccountsEl = document.getElementById("totalAccounts");
          const availableAccountsEl = document.getElementById("availableAccounts");

          if (totalAccountsEl) totalAccountsEl.textContent = filteredAccounts.length;
          if (availableAccountsEl) availableAccountsEl.textContent = availableAccounts;

          logDebug("Total akun available: ", availableAccounts);

          // Tampilkan/sembunyikan tombol Quick Renting
          const quickRentBtn = document.getElementById("quickRentBtn");
          const quickRent9Btn = document.getElementById("quickRent9Btn");
          const quickRent12Btn = document.getElementById("quickRent12Btn");
          const quickRent24Btn = document.getElementById("quickRent24Btn");

          if (quickRentBtn) {
            quickRentBtn.style.display = availableAccounts > 0 ? "block" : "none";
          } else {
            logDebug("ERROR: Tombol quickRentBtn tidak ditemukan!");
          }

          if (quickRent9Btn) {
            quickRent9Btn.style.display = availableAccounts > 0 ? "block" : "none";
          } else {
            logDebug("ERROR: Tombol quickRent9Btn tidak ditemukan!");
          }

          if (quickRent12Btn) {
            quickRent12Btn.style.display = availableAccounts > 0 ? "block" : "none";
          } else {
            logDebug("ERROR: Tombol quickRent12Btn tidak ditemukan!");
          }

          if (quickRent24Btn) {
            quickRent24Btn.style.display = availableAccounts > 0 ? "block" : "none";
          } else {
            logDebug("ERROR: Tombol quickRent24Btn tidak ditemukan!");
          }

          if (sort) {
            if (this.sortByExpiration) {
              logDebug("Mengurutkan akun berdasarkan expiration date");
              filteredAccounts.sort((a, b) => {
                const aExpirationPriority = this.getExpirationPriority(a.expirationDate);
                const bExpirationPriority = this.getExpirationPriority(b.expirationDate);
                return aExpirationPriority - bExpirationPriority;
              });
            } else {
              logDebug("Mengurutkan akun (Not Ready â†’ Available â†’ Rented) dan waktu tersisa");
              filteredAccounts.sort((a, b) => {
                if (!a.isReady && b.isReady) return -1;
                if (a.isReady && !b.isReady) return 1;

                if (!a.isReady && !b.isReady) {
                  return (a.username || a.name).localeCompare(b.username || b.name);
                }

                const aAvailable = this.isAccountAvailable(a);
                const bAvailable = this.isAccountAvailable(b);

                if (aAvailable && !bAvailable) return -1;
                if (!aAvailable && bAvailable) return 1;

                if (aAvailable && bAvailable) {
                  if (a.manuallyUpdated && !b.manuallyUpdated) return -1;
                  if (!a.manuallyUpdated && b.manuallyUpdated) return 1;

                  return a.username.localeCompare(b.username);
                }

                const aTime = new Date(a.availableAt).getTime();
                const bTime = new Date(b.availableAt).getTime();
                return aTime - bTime;
              });
            }

            logDebug("Pengurutan selesai");
          }

          // Render akun cards
          logDebug("Mulai render akun cards", filteredAccounts.length);
          filteredAccounts.forEach((account, index) => {
            const realIndex = this.accounts.indexOf(account);
            const isAvailable = this.isAccountAvailable(account);
            const availableAtText = isAvailable ? "Available" : formatDateTime(account.availableAt);

            // Mendapatkan waktu tersisa
            const remainingTime = !isAvailable ? getRemainingTime(account.availableAt) : null;

            // Text status berbeda untuk akun yang belum ready
            const statusText = !account.isReady ? "Not Ready" : isAvailable ? (account.manuallyUpdated ? "Available 100%" : "Available") : account.manuallyUpdated ? "Rented 100%" : "Rented";

            // Text status untuk info detail juga berbeda
            const detailStatusText = !account.isReady ? "Akun belum siap digunakan" : isAvailable ? (account.manuallyUpdated ? "Available 100%" : "Available") : (account.manuallyUpdated ? "Rented 100% until " : "Rented until ") + availableAtText;

            const accountCard = document.createElement("div");
            accountCard.className = "account-card";

            // Tambahkan class highlight jika ini adalah akun yang baru disewa
            if (realIndex === this.lastRentedIndex) {
              accountCard.classList.add("highlight");
            }

            accountCard.innerHTML = `
                        <div class="account-header">
                            <h2>${account.username ? account.username : account.name}</h2>
                            <span class="status ${!account.isReady ? "not-ready" : isAvailable ? "available" : "rented"}">
                                ${statusText}
                            </span>
                        </div>
                        <div class="account-body">
                            <div class="form-group">
                                <label for="username-${realIndex}">Username/Login:</label>
                                <div class="input-with-copy">
                                    <button class="small-copy-btn" data-copy-text="${account.username}" onclick="copyFieldFromData(this)" title="Copy Username">ðŸ“‹</button>
                                    <input type="text" id="username-${realIndex}" value="${account.username}" 
                                        onchange="accountManager.updateAccount(${realIndex}, {username: this.value})">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="password-${realIndex}">Password:</label>
                                <div class="input-with-copy">
                                    <button class="small-copy-btn" data-copy-text="${account.password}" onclick="copyFieldFromData(this)" title="Copy Password">ðŸ“‹</button>
                                    <input type="text" id="password-${realIndex}" value="${account.password}" 
                                        onchange="accountManager.updateAccount(${realIndex}, {password: this.value})">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="email-${realIndex}">Email:</label>
                                <div class="input-with-copy">
                                    <button class="small-copy-btn" data-copy-text="${account.email || ""}" onclick="copyFieldFromData(this)" title="Copy Email">ðŸ“‹</button>
                                    <input type="text" id="email-${realIndex}" value="${account.email || ""}" 
                                        onchange="accountManager.updateAccount(${realIndex}, {email: this.value})">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="expiration-${realIndex}">Account Expiration:</label>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <input type="text" id="expiration-${realIndex}" value="${account.expirationDate || ""}" 
                                        placeholder="Nov. 9, 2025, 5:32 a.m."
                                        onchange="accountManager.updateAccount(${realIndex}, {expirationDate: this.value})"
                                        style="flex: 1; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-family: 'Poppins', sans-serif; font-size: 0.9rem;">
                                    ${account.expirationDate ? this.getExpirationInfoInline(account.expirationDate) : '<span style="font-size: 0.85rem; color: #666; white-space: nowrap;">Belum diset</span>'}
                                </div>
                            </div>
                            <div class="time-info">
                                <strong>Status:</strong> ${detailStatusText}
                                ${remainingTime ? `<div><strong>Remaining:</strong> ${remainingTime}</div>` : ""}
                            </div>
                            <div class="btn-container">
                                ${
                                  !account.isReady
                                    ? `
                                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                        <button class="ready-btn" style="flex: 1;" onclick="accountManager.markAccountAsReady(${realIndex})">
                                            Account is Ready
                                        </button>
                                        <button class="reset-btn" style="flex: 1;" onclick="accountManager.resetAccount(${realIndex})">
                                            Reset
                                        </button>
                                    </div>
                                `
                                    : `
                                    <div class="btn-group duration-buttons">
                                        <button class="rent-btn" onclick="accountManager.rentAccount(${realIndex}, 6)">6 Jam</button>
                                        <button class="rent-btn" onclick="accountManager.rentAccount(${realIndex}, 9)">9 Jam</button>
                                        <button class="rent-btn" onclick="accountManager.rentAccount(${realIndex}, 12)">12 Jam</button>
                                        <button class="rent-btn" onclick="accountManager.rentAccount(${realIndex}, 24)">24 Jam</button>
                                    </div>
                                    <div class="btn-group control-buttons">
                                        <button class="manual-btn" onclick="openManualInput(${realIndex})">Manual</button>
                                        <button class="reset-btn" onclick="accountManager.autoResetWithDelay(${realIndex})">
                                            Reset
                                        </button>
                                        ${!isAvailable ? (account.lastRentedHours === 6 ? `<button class="update-btn" onclick="accountManager.updateRentTime(${realIndex})">Update Waktu</button>` : `<button class="update-btn btn-disabled" disabled>Update Waktu</button>`) : ""}
                                    </div>
                                `
                                }
                            </div>
                        </div>
                    `;
            container.appendChild(accountCard);
          });
          logDebug("Selesai render akun cards");

          // Update email filter counter secara real-time
          this.populateEmailFilter();
        }

        copyInfoWithTime(accountIndex, buttonElement = null) {
          const account = this.accounts[accountIndex];
          const isAvailable = this.isAccountAvailable(account);

          // Format teks yang akan disalin
          let infoText = `Username: ${account.username}\nPassword: ${account.password}`;

          // Menambahkan informasi waktu sewa jika akun sedang disewa
          if (!isAvailable && account.availableAt) {
            // Hitung waktu berdasarkan durasi asli (tanpa buffer 15 menit)
            const now = new Date();
            const hours = account.lastRentedHours || 6;
            const actualEndTime = new Date(now.getTime() + hours * 60 * 60 * 1000); // Tanpa buffer 15 menit

            // Format jam dan menit untuk waktu berakhir
            let endHours = actualEndTime.getHours();
            let endMinutes = String(actualEndTime.getMinutes()).padStart(2, "0");

            // Antisipasi pemblokiran oleh Shopee untuk angka yang mirip nomor handphone Indonesia (08xx)
            // Jika menit berakhir dengan '08', ubah menjadi '09' untuk teks yang disalin
            if (endMinutes === "08") {
              endMinutes = "09";
            }

            // Format waktu yang baru sesuai permintaan dengan menambahkan WIB
            infoText += `\nWaktu sewa sampai jam ${endHours}:${endMinutes} WIB (${hours} jam dari sekarang)`;
          }

          // Menambahkan informasi tambahan
          infoText += `\n\n- Wajib login dalam kurun waktu 1 jam`;

          // Hanya tambahkan pesan untuk mengabari jika durasi sewa adalah 6 jam
          const hours = account.lastRentedHours || 6;
          if (hours === 6) {
            infoText += `\n- Mohon di-infokan kepada kami jika sudah berhasil login`;
          }

          // Salin informasi ke clipboard
          const textarea = document.createElement("textarea");
          textarea.value = infoText;
          document.body.appendChild(textarea);
          textarea.select();
          document.execCommand("copy");
          document.body.removeChild(textarea);

          // Tampilkan notifikasi
          this.showNotification("Informasi akun telah disalin ke clipboard");

          // Jika ini adalah akun yang baru disewa, hapus highlight
          if (accountIndex === this.lastRentedIndex) {
            this.lastRentedIndex = -1;
            // Render ulang setelah info disalin untuk mengupdate urutan
            setTimeout(() => this.renderAccounts(), 1500);
          }
        }

        showNotification(message) {
          const notification = document.getElementById("notification");
          notification.textContent = message;
          notification.classList.add("show");

          // Hilangkan notifikasi setelah 3 detik
          setTimeout(() => {
            notification.classList.remove("show");
          }, 3000);
        }

        // Metode untuk mengekspor data akun ke file JSON
        exportData() {
          // Membuat objek blob dari data JSON
          const dataStr = JSON.stringify(this.accounts);
          const blob = new Blob([dataStr], { type: "application/json" });

          // Membuat URL untuk blob
          const url = URL.createObjectURL(blob);

          // Membuat elemen anchor untuk download
          const a = document.createElement("a");
          a.href = url;

          // Nama file dengan tanggal dan waktu saat ini
          const date = new Date();
          const timestamp = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, "0")}-${String(date.getDate()).padStart(2, "0")}_${String(date.getHours()).padStart(2, "0")}${String(date.getMinutes()).padStart(2, "0")}`;
          a.download = `unlock-tool-accounts-${timestamp}.json`;

          // Klik secara otomatis untuk memulai download
          document.body.appendChild(a);
          a.click();

          // Membersihkan
          document.body.removeChild(a);
          URL.revokeObjectURL(url);

          this.showNotification("Data akun berhasil diekspor ke file JSON");
        }

        // Metode untuk mengimpor data akun dari file JSON
        importData(file) {
          const reader = new FileReader();

          reader.onload = (event) => {
            try {
              const importedAccounts = JSON.parse(event.target.result);

              // Validasi data
              if (!Array.isArray(importedAccounts)) {
                throw new Error("Format data tidak valid");
              }

              // Impor data
              this.accounts = importedAccounts;
              this.saveAccounts();
              // Perbarui filter email setelah impor data
              this.populateEmailFilter();
              this.renderAccounts();

              this.showNotification("Data akun berhasil diimpor");
            } catch (error) {
              this.showNotification("Gagal mengimpor data: " + error.message);
              console.error("Error importing data:", error);
            }
          };

          reader.readAsText(file);
        }

        // Metode untuk mengisi dropdown filter email
        populateEmailFilter() {
          const emailFilter = document.getElementById("emailFilter");
          const customOptions = emailFilter.querySelector(".custom-options");

          // Hapus semua opsi kecuali opsi default
          while (customOptions.children.length > 1) {
            customOptions.removeChild(customOptions.lastChild);
          }

          // Ambil semua email yang tidak kosong
          const emails = this.accounts.filter((account) => account.email && account.email.trim() !== "").map((account) => account.email);

          // Kelompokkan email berdasarkan domain
          const emailsByDomain = {};
          emails.forEach((email) => {
            const parts = email.split("@");
            if (parts.length === 2) {
              const domain = parts[1]; // Bagian domain (setelah @)
              if (!emailsByDomain[domain]) {
                emailsByDomain[domain] = [];
              }
              if (!emailsByDomain[domain].includes(email)) {
                emailsByDomain[domain].push(email);
              }
            }
          });

          // Urutkan domain secara alfabetis
          const sortedDomains = Object.keys(emailsByDomain).sort();

          // Untuk setiap domain, urutkan emailnya dan tambahkan ke dropdown
          sortedDomains.forEach((domain) => {
            // Urutkan email dalam domain yang sama
            const sortedEmails = emailsByDomain[domain].sort();

            sortedEmails.forEach((email) => {
              // Hitung total akun dengan email ini
              const totalAccounts = this.accounts.filter((account) => account.email === email).length;

              // Hitung available akun dengan email ini
              const availableAccounts = this.accounts.filter((account) => account.email === email && this.isAccountAvailable(account)).length;

              const option = document.createElement("div");
              option.className = "custom-option";
              option.setAttribute("data-value", email);
              // Gunakan innerHTML untuk styling warna berbeda
              option.innerHTML = `${email} (<span class="email-counter-available">${availableAccounts}</span>/<span class="email-counter-total">${totalAccounts}</span>)`;
              customOptions.appendChild(option);
            });
          });

          // Set nilai dropdown ke email yang dipilih saat ini
          this.updateCustomSelectValue(this.selectedEmail);
        }

        // Method helper untuk update custom select value
        updateCustomSelectValue(value) {
          const emailFilter = document.getElementById("emailFilter");
          const selectTrigger = emailFilter.querySelector(".select-trigger span");
          const customOptions = emailFilter.querySelectorAll(".custom-option");

          // Update tampilan trigger
          if (value === "") {
            selectTrigger.textContent = "Semua Email";
          } else {
            const selectedOption = [...customOptions].find((opt) => opt.getAttribute("data-value") === value);
            if (selectedOption) {
              selectTrigger.innerHTML = selectedOption.innerHTML;
            }
          }

          // Update class selected
          customOptions.forEach((opt) => {
            if (opt.getAttribute("data-value") === value) {
              opt.classList.add("selected");
            } else {
              opt.classList.remove("selected");
            }
          });
        }

        // Metode untuk mengatur filter email
        setEmailFilter(email) {
          this.selectedEmail = email;
          this.renderAccounts();

          // Auto-copy email ke clipboard jika email dipilih (bukan "Semua Email")
          if (email && email.trim() !== "") {
            this.copyEmailToClipboard(email);
          }

          // Perbarui custom dropdown
          this.updateCustomSelectValue(email);
        }

        // Method helper untuk copy email ke clipboard
        copyEmailToClipboard(email) {
          const textarea = document.createElement("textarea");
          textarea.value = email;
          document.body.appendChild(textarea);
          textarea.select();
          document.execCommand("copy");
          document.body.removeChild(textarea);

          // Tampilkan notifikasi
          this.showNotification(`ðŸ“§ Email "${email}" telah disalin ke clipboard`);
        }

        // Method untuk mendapatkan informasi expiration
        getExpirationInfo(expirationDate) {
          if (!expirationDate) return '';
          
          const today = new Date();
          let expDate;
          
          // Parse format "Nov. 9, 2025, 5:32 a.m." atau format standar
          try {
            // Coba parse format copy-paste
            expDate = new Date(expirationDate);
            
            // Jika parsing gagal, coba beberapa format lain
            if (isNaN(expDate.getTime())) {
              // Handle format dengan titik setelah bulan: "Nov. 9, 2025"
              const cleanDate = expirationDate.replace(/\./g, '').replace(/,/g, '');
              expDate = new Date(cleanDate);
            }
            
            if (isNaN(expDate.getTime())) {
              return '<div style="font-size: 0.85rem; color: #e03131; margin-top: 5px; font-weight: 600;">Format tanggal tidak valid</div>';
            }
          } catch (error) {
            return '<div style="font-size: 0.85rem; color: #e03131; margin-top: 5px; font-weight: 600;">Format tanggal tidak valid</div>';
          }
          
          const diffTime = expDate - today;
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
          
          let statusText = '';
          let statusColor = '';
          
          if (diffDays < 0) {
            statusText = `Expired ${Math.abs(diffDays)} hari yang lalu`;
            statusColor = '#e03131'; // Merah
          } else if (diffDays === 0) {
            statusText = 'Expired hari ini';
            statusColor = '#e03131'; // Merah
          } else if (diffDays <= 7) {
            statusText = `${diffDays} hari lagi (Segera expired!)`;
            statusColor = '#f59f00'; // Orange
          } else if (diffDays <= 30) {
            statusText = `${diffDays} hari lagi`;
            statusColor = '#f59f00'; // Orange
          } else {
            statusText = `${diffDays} hari lagi`;
            statusColor = '#0ca678'; // Hijau
          }
          
          return `<div style="font-size: 0.85rem; color: ${statusColor}; margin-top: 5px; font-weight: 600;">${statusText}</div>`;
        }

        // Method untuk mendapatkan informasi expiration dalam format inline (satu baris)
        getExpirationInfoInline(expirationDate) {
          if (!expirationDate) return '';
          
          const today = new Date();
          let expDate;
          
          // Parse format "Nov. 9, 2025, 5:32 a.m." atau format standar
          try {
            // Coba parse format copy-paste
            expDate = new Date(expirationDate);
            
            // Jika parsing gagal, coba beberapa format lain
            if (isNaN(expDate.getTime())) {
              // Handle format dengan titik setelah bulan: "Nov. 9, 2025"
              const cleanDate = expirationDate.replace(/\./g, '').replace(/,/g, '');
              expDate = new Date(cleanDate);
            }
            
            if (isNaN(expDate.getTime())) {
              return '<span style="font-size: 0.85rem; color: #e03131; font-weight: 600; white-space: nowrap;">Format salah</span>';
            }
          } catch (error) {
            return '<span style="font-size: 0.85rem; color: #e03131; font-weight: 600; white-space: nowrap;">Format salah</span>';
          }
          
          const diffTime = expDate - today;
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
          
          let statusText = '';
          let statusColor = '';
          
          if (diffDays < 0) {
            statusText = `Expired ${Math.abs(diffDays)} hari lalu`;
            statusColor = '#e03131'; // Merah
          } else if (diffDays === 0) {
            statusText = 'Expired hari ini';
            statusColor = '#e03131'; // Merah
          } else if (diffDays <= 7) {
            statusText = `${diffDays} hari lagi!`;
            statusColor = '#f59f00'; // Orange
          } else if (diffDays <= 30) {
            statusText = `${diffDays} hari lagi`;
            statusColor = '#f59f00'; // Orange
          } else {
            statusText = `${diffDays} hari lagi`;
            statusColor = '#0ca678'; // Hijau
          }
          
          return `<span style="font-size: 0.85rem; color: ${statusColor}; font-weight: 600; white-space: nowrap;">${statusText}</span>`;
        }

        // Method untuk mendapatkan prioritas expiration untuk sorting
        getExpirationPriority(expirationDate) {
          if (!expirationDate) return 999; // No expiration set = lowest priority
          
          const today = new Date();
          let expDate;
          
          try {
            expDate = new Date(expirationDate);
            if (isNaN(expDate.getTime())) {
              const cleanDate = expirationDate.replace(/\./g, '').replace(/,/g, '');
              expDate = new Date(cleanDate);
            }
            
            if (isNaN(expDate.getTime())) {
              return 998; // Invalid format = very low priority
            }
          } catch (error) {
            return 998; // Error parsing = very low priority
          }
          
          const diffTime = expDate - today;
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
          
          // Priority levels (lower number = higher priority):
          if (diffDays < 0) return 1;      // Already expired - HIGHEST priority
          if (diffDays === 0) return 2;    // Expires today - VERY HIGH priority
          if (diffDays <= 7) return 3;     // Expires within 7 days - HIGH priority
          if (diffDays <= 30) return 4;    // Expires within 30 days - MEDIUM priority
          
          // For longer periods, use the actual days as priority (inverted)
          // So accounts expiring sooner get higher priority
          return 100 + diffDays; // LOWER priority, but still sorted by days remaining
        }

        // Method untuk toggle sort by expiration
        toggleSortByExpiration() {
          this.sortByExpiration = !this.sortByExpiration;
          
          // Update visual state tombol
          const sortBtn = document.getElementById("sortByExpirationBtn");
          if (this.sortByExpiration) {
            sortBtn.classList.add("active");
            sortBtn.textContent = "ðŸ“… Sort Normal";
            this.showNotification("Sorting berdasarkan expiration date");
          } else {
            sortBtn.classList.remove("active");
            sortBtn.textContent = "ðŸ“… Sort Expiration";
            this.showNotification("Sorting normal (default)");
          }
          
          // Re-render dengan sorting baru
          this.renderAccounts(true);
        }



        // Method untuk pindah ke email berikutnya
        moveToNextEmail() {
          const emailFilter = document.getElementById("emailFilter");
          const customOptions = emailFilter.querySelectorAll(".custom-option");
          
          // Dapatkan semua email yang tersedia (kecuali "Semua Email")
          const availableEmails = [];
          customOptions.forEach(option => {
            const value = option.getAttribute("data-value");
            if (value && value.trim() !== "") {
              availableEmails.push(value);
            }
          });

          if (availableEmails.length === 0) {
            this.showNotification("Tidak ada email yang tersedia untuk dipindah");
            return;
          }

          // Cari index email yang sedang dipilih
          let currentIndex = -1;
          if (this.selectedEmail) {
            currentIndex = availableEmails.indexOf(this.selectedEmail);
          }

          // Pindah ke email berikutnya (atau ke email pertama jika sudah di akhir atau belum ada yang dipilih)
          const nextIndex = (currentIndex + 1) % availableEmails.length;
          const nextEmail = availableEmails[nextIndex];

          // Set filter ke email berikutnya (ini akan otomatis trigger auto-copy)
          this.setEmailFilter(nextEmail);
        }

        // Metode untuk mengatur filter pencarian username
        setSearchQuery(query) {
          this.searchQuery = query;
          this.renderAccounts();
        }

        // Metode untuk quick renting (otomatis menyewa akun yang tersedia)
        quickRent(hours = 6) {
          // Cek apakah tombol sedang dalam masa cooldown
          const rentBtnId = hours === 6 ? "quickRentBtn" : hours === 9 ? "quickRent9Btn" : hours === 12 ? "quickRent12Btn" : "quickRent24Btn";
          const rentBtn = document.getElementById(rentBtnId);
          if (rentBtn.disabled) {
            return;
          }

          // Filter untuk mendapatkan daftar akun yang tersedia
          const availableAccounts = this.accounts.filter((account) => this.isAccountAvailable(account) && account.username && account.username.trim() !== "" && account.password && account.password.trim() !== "");

          if (availableAccounts.length === 0) {
            this.showNotification("Tidak ada akun yang tersedia untuk disewa!");
            return;
          }

          // Prioritaskan akun yang available 100% (yang diupdate manual)
          const available100Accounts = availableAccounts.filter((account) => account.manuallyUpdated);

          // Pilih akun yang akan disewa
          let accountToRent;

          if (available100Accounts.length > 1) {
            // Jika ada lebih dari 1 akun available 100%, gunakan salah satu dan sisakan 1
            accountToRent = available100Accounts[0]; // Ambil yang pertama
            this.showNotification(`Menyewa akun Available 100% untuk ${hours} jam: ${accountToRent.username}`);
          } else if (available100Accounts.length === 1 && availableAccounts.length > 1) {
            // Jika hanya ada 1 akun available 100% dan ada akun lain tersedia, gunakan akun biasa
            // Cari akun available biasa (yang bukan available 100%)
            accountToRent = availableAccounts.find((account) => !account.manuallyUpdated);
            this.showNotification(`Menyewa akun available biasa untuk ${hours} jam: ${accountToRent.username} (menyisakan 1 akun Available 100%)`);
          } else {
            // Tidak ada akun available 100% atau hanya ada 1 akun tersedia (yang bukan 100%)
            accountToRent = availableAccounts[0];
            this.showNotification(`Menyewa akun available untuk ${hours} jam: ${accountToRent.username}`);
          }

          // Dapatkan index akun di array utama dan sewa sesuai durasi
          const accountIndex = this.accounts.indexOf(accountToRent);
          if (accountIndex !== -1) {
            this.rentAccount(accountIndex, hours);

            // Aktifkan proteksi double click
            this.enableClickProtection(rentBtnId);
          }
        }

        // Metode untuk mengaktifkan proteksi double click
        enableClickProtection(buttonId = "quickRentBtn") {
          const quickRentBtn = document.getElementById(buttonId);
          const originalText = quickRentBtn.textContent;
          const cooldownTime = 3; // 3 detik cooldown

          // Nonaktifkan tombol
          quickRentBtn.disabled = true;

          // Menampilkan efek visual cooldown
          quickRentBtn.style.backgroundColor = "#adb5bd";
          quickRentBtn.style.cursor = "not-allowed";

          // Tampilkan hitungan mundur
          let countdown = cooldownTime;
          quickRentBtn.textContent = `Tunggu (${countdown})`;

          // Update hitungan mundur setiap detik
          const timer = setInterval(() => {
            countdown--;
            quickRentBtn.textContent = `Tunggu (${countdown})`;

            if (countdown <= 0) {
              // Kembalikan tombol ke keadaan semula
              clearInterval(timer);
              quickRentBtn.disabled = false;
              quickRentBtn.textContent = originalText;
              quickRentBtn.style.backgroundColor = "";
              quickRentBtn.style.cursor = "";
            }
          }, 1000);
        }

        // Metode untuk menghapus akun dari daftar
        deleteAccount(index) {
          // Konfirmasi penghapusan
          if (confirm(`Apakah Anda yakin ingin menghapus akun ${this.accounts[index].name}?`)) {
            // Hapus akun dari array
            this.accounts.splice(index, 1);
            this.saveAccounts();
            this.populateEmailFilter();
            this.renderAccounts();
            this.showNotification("Akun berhasil dihapus");
          }
        }

        syncWithDatabase() {
          fetch("https://shopee.seninselasatechno.com/accounts-sync/sync-from-frontend", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ accounts: this.accounts }),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                this.showNotification(`âœ… Sinkronisasi berhasil (${data.result.inserted} ditambahkan, ${data.result.updated} diperbarui)`);
                console.log("Sync result:", data.result);
              } else {
                this.showNotification("âŒ Gagal menyinkronkan akun ke database");
                console.error("Sync error:", data.message);
              }
            })
            .catch((error) => {
              this.showNotification("âŒ Gagal terhubung ke server");
              console.error("Sync request failed:", error);
            });
        }

        // Metode untuk reset semua akun available (bisa dipanggil manual/otomatis)
        resetAllAvailable() {
          // kumpulkan semua index akun yg available
          const availableIndices = this.accounts.map((acc, i) => (this.isAccountAvailable(acc) ? i : null)).filter((i) => i !== null);
          if (availableIndices.length === 0) {
            this.showNotification("Tidak ada akun available untuk direset");
            return;
          }

          // Hitung berapa banyak akun rented yang akan direset
          let rentedCount = 0;
          availableIndices.forEach((idx) => {
            const account = this.accounts[idx];
            // Cek apakah account pernah di-rent hari ini (punya availableAt)
            if (account.availableAt) {
              rentedCount++;
            }
          });

          // reset instan semua akun
          availableIndices.forEach((idx) => {
            const wasManual = this.accounts[idx].manuallyUpdated;
            this.updateAccount(idx, {
              availableAt: null,
              manuallyUpdated: wasManual,
            });
          });



          // update label reset terakhir
          document.getElementById("lastResetTime").textContent = formatHHMM(new Date());
          this.showNotification(`Auto-reset ${availableIndices.length} akun selesai`);
        }

        // Tambahkan method baru untuk reset dengan delay dan proteksi race condition
        autoResetWithDelay(index, hours = 6) {
          // Cek apakah account sedang di-rent sebelum reset
          const account = this.accounts[index];
          const wasRented = account.availableAt && new Date(account.availableAt) > new Date();
          const wasManual = account.manuallyUpdated;
          
          // Reset instan tanpa delay
          this.updateAccount(index, {
            availableAt: null,
            manuallyUpdated: wasManual,
          });

          this.clearSearchBox(); // â¬…ï¸ tambahkan
          this.renderAccounts();
        }

        // Tambahkan method manualReset di atas autoResetWithDelay
        manualReset(index) {
          // batalkan timer jika ada
          if (this.resetTimers[index]) {
            clearTimeout(this.resetTimers[index]);
            delete this.resetTimers[index];
          }
          // langsung reset tanpa sewa ulang
          this.resetAccount(index);
          this.clearSearchBox(); // â¬…ï¸ tambahkan
        }

        // Metode untuk mengelola password cards
        populatePasswordFilter() {
          // Hanya render password list cards, tidak ada dropdown lagi
          this.renderPasswordList();
        }

        // Metode untuk mengatur filter password
        setPasswordFilter(password) {
          // Jika password yang sama diklik lagi, lakukan unfilter
          if (this.selectedPassword === password) {
            this.selectedPassword = "";
            // Hilangkan highlight
            document.querySelectorAll(".password-card").forEach((card) => card.classList.remove("active"));
            this.renderAccounts();
            return;
          }
          // Jika password berbeda, lakukan filter & highlight
          this.selectedPassword = password;
          // Highlight card yang dipilih
          const passwordCards = document.querySelectorAll(".password-card");
          passwordCards.forEach((card) => {
            if (card.getAttribute("data-password") === password) {
              card.classList.add("active");
            } else {
              card.classList.remove("active");
            }
          });
          this.renderAccounts();
          this.populatePasswordFilter(); // Pastikan UI selalu update setelah set
        }

        renderPasswordList() {
          const container = document.getElementById("passwordListContainer");
          if (!container) return;
          container.innerHTML = "";
          // Ambil password unik
          const passwords = Array.from(new Set(this.accounts.filter((acc) => acc.password && acc.password.trim() !== "").map((acc) => acc.password)));
          passwords.sort();
          passwords.forEach((pwd) => {
            const item = document.createElement("div");
            item.className = "password-card";
            // Tambahkan kelas active jika password ini adalah password yang terpilih
            if (pwd === this.selectedPassword) {
              item.classList.add("active");
            }
            item.setAttribute("data-password", pwd);
            item.innerHTML = `
              <span title="Klik untuk filter password ini">${pwd}</span>
              <button class="delete-btn" title="Hapus password ini dari semua akun">&times;</button>
            `;

            const span = item.querySelector("span");
            span.addEventListener("click", () => {
              // Toggle: jika sudah aktif, maka unfilter
              this.setPasswordFilter(pwd);
            });

            const btn = item.querySelector(".delete-btn");
            btn.addEventListener("click", (e) => {
              e.stopPropagation();
              if (confirm(`Hapus password '${pwd}' dari semua akun?`)) {
                this.deletePasswordFromAllAccounts(pwd);
              }
            });
            container.appendChild(item);
          });

          // Inisialisasi Sortable untuk drag dan drop
          if (!this.passwordSortable) {
            this.passwordSortable = new Sortable(container, {
              animation: 150,
              ghostClass: "sortable-ghost",
              chosenClass: "sortable-chosen",
              dragClass: "sortable-drag",
              easing: "cubic-bezier(0.2, 0, 0.13, 2)",
              delay: 50, // Delay sebelum drag dimulai
              delayOnTouchOnly: true,
              touchStartThreshold: 3,
              onEnd: (evt) => {
                // Menunjukkan notifikasi posisi password telah diubah
                this.showNotification("Posisi password berhasil diubah");

                // Simpan urutan password dalam localStorage jika diperlukan
                const passwords = Array.from(container.children).map((el) => el.getAttribute("data-password"));
                localStorage.setItem("passwordOrder", JSON.stringify(passwords));
              },
            });
          }

          // Restore urutan password dari localStorage jika ada
          const savedOrder = localStorage.getItem("passwordOrder");
          if (savedOrder) {
            try {
              const orderArray = JSON.parse(savedOrder);
              // Urutkan password card berdasarkan order yang tersimpan
              [...container.children]
                .sort((a, b) => {
                  const aIndex = orderArray.indexOf(a.getAttribute("data-password"));
                  const bIndex = orderArray.indexOf(b.getAttribute("data-password"));
                  // Jika tidak ada dalam array, letakkan di akhir
                  if (aIndex === -1) return 1;
                  if (bIndex === -1) return -1;
                  return aIndex - bIndex;
                })
                .forEach((node) => container.appendChild(node));
            } catch (e) {
              console.error("Error restoring password order:", e);
            }
          }
        }

        deletePasswordFromAllAccounts(pwd) {
          let changed = false;
          this.accounts.forEach((acc, i) => {
            if (acc.password === pwd) {
              this.updateAccount(i, { password: "" });
              changed = true;
            }
          });
          if (changed) {
            this.showNotification(`Password '${pwd}' dihapus dari semua akun.`);
            this.populatePasswordFilter();
            this.renderPasswordList();
          }
        }
      }

      // Inisialisasi manager akun ketika halaman dimuat
      let accountManager;
      let currentAccountIndex = -1;

      // Fungsi untuk membuka modal input manual
      function openManualInput(accountIndex) {
        currentAccountIndex = accountIndex;

        // Set tanggal dan waktu default ke hari ini
        const today = new Date();
        const dateInput = document.getElementById("manualDate");
        const timeInput = document.getElementById("manualTime");

        // Format tanggal untuk input date (YYYY-MM-DD)
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, "0");
        const day = String(today.getDate()).padStart(2, "0");
        dateInput.value = `${year}-${month}-${day}`;

        // Format waktu untuk input time (HH:MM)
        const hours = String(today.getHours()).padStart(2, "0");
        const minutes = String(today.getMinutes()).padStart(2, "0");
        timeInput.value = `${hours}:${minutes}`;

        // Tampilkan modal
        const modal = document.getElementById("manualModal");
        modal.style.display = "block";
      }

      // Fungsi untuk menutup modal
      function closeManualModal() {
        const modal = document.getElementById("manualModal");
        modal.style.display = "none";
        currentAccountIndex = -1;
      }

      // Fungsi untuk mengubah jenis input waktu pada modal
      function toggleTimeInputType() {
        const exactInputs = document.getElementById("exactTimeInputs");
        const durationInputs = document.getElementById("durationInputs");
        const inputType = document.querySelector('input[name="timeInputType"]:checked').value;

        if (inputType === "exact") {
          exactInputs.style.display = "block";
          durationInputs.style.display = "none";
        } else {
          exactInputs.style.display = "none";
          durationInputs.style.display = "block";
        }
      }

      // Fungsi untuk menyimpan input manual
      function saveManualTime() {
        if (currentAccountIndex === -1) return;

        const inputType = document.querySelector('input[name="timeInputType"]:checked').value;
        let dateTime;

        if (inputType === "exact") {
          const dateInput = document.getElementById("manualDate").value;
          const timeInput = document.getElementById("manualTime").value;

          if (!dateInput || !timeInput) {
            alert("Mohon isi tanggal dan waktu!");
            return;
          }

          // Gabungkan tanggal dan waktu
          dateTime = new Date(`${dateInput}T${timeInput}`);
        } else {
          const hours = parseInt(document.getElementById("durationHours").value) || 0;
          const minutes = parseInt(document.getElementById("durationMinutes").value) || 0;

          if (hours === 0 && minutes === 0) {
            alert("Mohon masukkan durasi yang valid!");
            return;
          }

          // Hitung waktu berdasarkan durasi
          const now = new Date();
          dateTime = new Date(now.getTime() + hours * 60 * 60 * 1000 + minutes * 60 * 1000);
        }

        // Simpan ke akun
        accountManager.setManualRentTime(currentAccountIndex, dateTime);

        // Tutup modal
        closeManualModal();
      }

      // Fungsi untuk memproses input bulk add account
      function processBulkAccounts() {
        console.log("processBulkAccounts() dipanggil");

        // Cek apakah accountManager tersedia
        if (!accountManager) {
          console.error("accountManager tidak tersedia!");
          alert("Error: Account Manager belum diinisialisasi!");
          return;
        }

        const bulkInput = document.getElementById("bulkInput").value.trim();
        console.log("Input bulk:", bulkInput);

        if (!bulkInput) {
          alert("Silakan masukkan data akun!");
          return;
        }

        // Coba parsing dengan berbagai format
        let accountGroups = [];

        // Format 1: Split berdasarkan baris kosong ganda
        if (bulkInput.includes("\n\n")) {
          accountGroups = bulkInput.split(/\n\s*\n+/);
          console.log("Menggunakan format baris kosong ganda, groups:", accountGroups);
        }
        // Format 2: Split berdasarkan baris baru biasa (setiap 2 baris = 1 akun)
        else {
          const allLines = bulkInput
            .split("\n")
            .map((line) => line.trim())
            .filter((line) => line);
          console.log("Semua baris:", allLines);

          // Kelompokkan setiap 2 baris menjadi 1 akun
          for (let i = 0; i < allLines.length; i += 2) {
            if (i + 1 < allLines.length) {
              accountGroups.push(allLines[i] + "\n" + allLines[i + 1]);
            }
          }
          console.log("Menggunakan format 2 baris per akun, groups:", accountGroups);
        }

        let addedCount = 0;

        accountGroups.forEach((group, index) => {
          console.log(`Processing group ${index}:`, group);
          const lines = group.trim().split("\n");
          console.log(`Lines in group ${index}:`, lines);

          // Setiap grup harus memiliki minimal 2 baris (username dan email)
          if (lines.length >= 2) {
            const username = lines[0].trim();
            const email = lines[1].trim();
            console.log(`Username: "${username}", Email: "${email}"`);

            // Validasi username dan email
            const isValidEmail = email.includes("@") && email.includes(".");

            if (username && email && isValidEmail) {
              // Tambahkan akun baru - cari ID tertinggi yang valid
              const validIds = accountManager.accounts.map((account) => account.id).filter((id) => typeof id === "number" && !isNaN(id));
              const newId = validIds.length > 0 ? Math.max(...validIds) + 1 : 1;

              // Validasi bahwa newId adalah angka yang valid
              if (typeof newId !== "number" || isNaN(newId)) {
                console.error("Error: newId tidak valid:", newId);
                alert("Error: Tidak dapat menentukan ID untuk akun baru");
                return;
              }

              const newAccount = {
                id: newId,
                name: `Akun ${newId}`,
                username: username,
                password: "wawawa666",
                email: email,
                availableAt: null,
                expirationDate: "", // Ganti note dengan expirationDate
                isReady: false, // Akun dari bulk add belum ready
              };

              console.log("Menambahkan akun:", newAccount);
              // Tambahkan akun baru ke awal array
              accountManager.accounts.unshift(newAccount);
              addedCount++;
            } else {
              console.log(`Akun tidak valid - username: "${username}", email: "${email}", isValidEmail: ${isValidEmail}`);
            }
          } else {
            console.log(`Group tidak memiliki cukup baris (${lines.length}):`, lines);
          }
        });

        console.log(`Total akun ditambahkan: ${addedCount}`);

        if (addedCount > 0) {
          // Simpan perubahan dan render ulang
          accountManager.saveAccounts();
          accountManager.populateEmailFilter();
          accountManager.renderAccounts();

          // Tampilkan notifikasi
          accountManager.showNotification(`${addedCount} akun baru berhasil ditambahkan`);

          // Tutup modal
          closeBulkModal();

          // Reset form
          document.getElementById("bulkInput").value = "";
        } else {
          alert("Tidak ada akun valid yang ditemukan. Pastikan format data benar!\n\nFormat yang didukung:\n1. Username\\nEmail\\n\\nUsername2\\nEmail2\n2. Username\\nEmail\\nUsername2\\nEmail2");
        }
      }

      // Fungsi untuk menampilkan modal bulk add
      function openBulkModal() {
        const modal = document.getElementById("bulkAddModal");
        modal.style.display = "block";
      }

      // Fungsi untuk menutup modal bulk add
      function closeBulkModal() {
        const modal = document.getElementById("bulkAddModal");
        modal.style.display = "none";
      }

      // Modal Bulk Change Password
      function openBulkChangePwdModal() {
        const modal = document.getElementById("bulkChangePwdModal");
        modal.style.display = "block";
      }

      function closeBulkChangePwdModal() {
        document.getElementById("bulkChangePwdModal").style.display = "none";
      }

      function applyBulkChangePwd() {
        const pwd = document.getElementById("newPassword").value.trim();
        const emailFilter = accountManager.selectedEmail; // Gunakan selectedEmail dari accountManager
        if (!pwd) {
          alert("Masukkan password baru");
          return;
        }

        let changedCount = 0;
        accountManager.accounts.forEach((acc, i) => {
          const isAvail = accountManager.isAccountAvailable(acc);
          // Jika tidak ada email filter yang dipilih, ubah semua akun available
          const emailMatch = !emailFilter || acc.email === emailFilter;

          if (isAvail && emailMatch) {
            accountManager.updateAccount(i, { password: pwd });
            changedCount++;
          }
        });

        if (changedCount > 0) {
          accountManager.showNotification(`Password diubah untuk ${changedCount} akun available`);
        } else {
          accountManager.showNotification("Tidak ada akun available yang sesuai filter");
        }
        closeBulkChangePwdModal();
      }

      // Tutup modal jika klik di luar area modal
      window.addEventListener("click", (event) => {
        const bulkChangePwdModal = document.getElementById("bulkChangePwdModal");
        if (event.target == bulkChangePwdModal) {
          closeBulkChangePwdModal();
        }
      });

      // Helper format jam:menit
      function formatHHMM(date) {
        const h = String(date.getHours()).padStart(2, "0");
        const m = String(date.getMinutes()).padStart(2, "0");
        return `${h}:${m}`;
      }

      // Helper untuk debug
      function logDebug(message, data) {
        console.log("[DEBUG] " + message, data || "");
      }
    </script>
  </body>
</html>
